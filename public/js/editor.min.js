var editor={};(function(){function c(){editor.client=hemi.makeClients()[0],d(),editor.ui.initializeView(editor.client),editor.projects.init(),editor.plugins.init()}function d(){hemi.subscribe(hemi.msg.worldCleanup,function(a){editor.notifyListeners(editor.events.WorldCleaned)}),hemi.subscribe(hemi.msg.ready,function(){editor.notifyListeners(editor.events.WorldLoaded),editor.projects.loadingDone()})}function e(){hemi.core.client&&hemi.core.client.cleanup()}"use strict";var a=function(){this.worldSpecs=new hemi.utils.Hashtable,this.editorSpecs=null};a.prototype={swap:function(){this.editorSpecs===null&&(this.editorSpecs=hemi.dispatch.msgSpecs,hemi.dispatch.msgSpecs=this.worldSpecs)},unswap:function(){this.editorSpecs!==null&&(hemi.dispatch.msgSpecs=this.editorSpecs,this.editorSpecs=null)},getTargetSpec:function(a){this.swap();var b=hemi.dispatch.getTargetSpec(a);return this.unswap(),b},getTargets:function(a,b){this.swap();var c=hemi.dispatch.getTargets(a,b);return this.unswap(),c},registerTarget:function(a,b,c,d,e){this.swap();var f=hemi.dispatch.registerTarget(a,b,c,d,e);return this.unswap(),f},removeTarget:function(a,b){this.swap();var c=hemi.dispatch.removeTarget(a,b);return this.unswap(),c},cleanup:function(){this.swap(),hemi.dispatch.cleanup(),this.unswap()},toOctane:function(){this.swap();var a=hemi.dispatch.toOctane();return this.unswap(),a}};var b=new a;editor.getActivePlugins=function(){return activePlugins},editor.getActiveTool=function(){var a=editor.getViews();for(var b=0,c=a.length;b<c;b++){var d=a[b];if(d.mode===editor.ToolConstants.MODE_DOWN)return d}return null},editor.getCss=function(a,b){jQuery(document.createElement("link")).attr({href:a,media:b||"screen",type:"text/css",rel:"stylesheet"}).appendTo("head")},editor.getDispatchProxy=function(){return b},editor.getProjectOctane=function(){b.swap();var a=hemi.world.toOctane(function(a){return a.name.search(editor.ToolConstants.EDITOR_PREFIX)===-1});return b.unswap(),a},editor.getScript=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.src=a,editor.notifyListeners(editor.events.ScriptLoadStart,a);var d=!1;c.onload=c.onreadystatechange=function(){!d&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")&&(d=!0,b&&b(),editor.notifyListeners(editor.events.ScriptLoaded,a),c.onload=c.onreadystatechange=null)},document.body.appendChild(c)},window.onload=function(){c()}})(),function(a){a.events={Cancel:"editor.Cancel",ColorPicked:"editor.ColorPicked",Created:"editor.Created",Edit:"editor.Edit",Editing:"editor.Editing",Enabled:"editor.Enabled",Loaded:"editor.Loaded",MenuItemClicked:"editor.MenuItemClicked",ModelAdded:"editor.ModelAdded",PanelVisible:"editor.PanelVisible",PluginLoaded:"editor.PluginLoaded",PluginRemoved:"editor.PluginRemoved",Remove:"editor.Remove",Removing:"editor.Removing",Save:"editor.Save",ScriptLoaded:"editor.ScriptLoaded",ScriptLoadStart:"editor.ScriptLoadStart",SidebarSet:"editor.SidebarSet",ToolClicked:"editor.ToolClicked",ToolModeSet:"editor.ToolModeSet",ToolMouseIn:"editor.ToolMouseIn",ToolMouseOut:"editor.ToolMouseOut",Updated:"editor.Updated",ViewAdded:"editor.ViewAdded",WidgetVisible:"editor.WidgetVisible",WorldCleaned:"editor.WorldCleaned",WorldLoaded:"editor.WorldLoaded"}}(editor),function(a){"use strict",a.utils=a.utils||{};var b=a.utils.Listenable=function(){this.listeners=new Hashtable};b.prototype.addListener=function(a,b){var c=this.listeners.get(a);c||(c=[]);var d=c.indexOf(b);d==-1&&c.push(b),this.listeners.put(a,c)},b.prototype.removeListener=function(a){var b=null;if(this.listeners.containsValue(a)){var c=this.listeners.keys();for(var d=0,e=c.length;d<e&&!b;d++){var f=this.listeners.get(c[d]),g=f.indexOf(a);if(g!=-1){var h=f.splice(g,1);h.length==1&&(b=h[0])}}}return b},b.prototype.notifyListeners=function(a,b){var c=this.listeners.get(a);if(c)for(var d=0,e=c.length;d<e;d++){var f=c[d],g=jQuery.isFunction(f);g?f(b):f.notify(a,b)}};var c=new a.utils.Listenable;a.addListener=function(a,b){c.addListener(a,b)},a.notifyListeners=function(a,b){c.notifyListeners(a,b)},a.removeListener=function(a){c.removeListener(a)}}(editor),function(a){"use strict",a.utils=a.utils||{},a.utils.roundNumber=function(a,b){var c=Math.round(a*Math.pow(10,b))/Math.pow(10,b);return c},a.utils.getFunctionParams=function(a){return a.toString().match(/\((.*?)\)/)[1].match(/[\w]+/g)||[]}}(editor),function(a){function c(a){var b="";for(var c=0,d=a.length;c<d;++c){var e=a[c],f=e.name,g;e.getCitizenType?g=e.getCitizenType().split(".").pop():g="Behavior",c!==0&&(b+=", <br>"),b+=f+" ("+g+")"}return b}"use strict",a.depends=a.depends||{};var b=function(){this.depends=new Hashtable};b.prototype.addDependency=function(a,b){var c=this.getDependencies(b);c.indexOf(a)===-1&&c.push(a),this.depends.put(b._getId(),c)},b.prototype.clearDependencies=function(a){a._getId&&this.depends.remove(a._getId())},b.prototype.getDependencies=function(a,b){var c=this.depends.get(a._getId())||[];if(b)for(var d=0;d<c.length;++d){var e=c[d];if(e._getId){var f=this.depends.get(e._getId())||[];for(var g=0,h=f.length;g<h;++g)gc=f[g],c.indexOf(gc)===-1&&c.push(gc)}}return c},b.prototype.removeDependency=function(a,b){var c=this.getDependencies(b),d=c.indexOf(a);d!==-1&&c.splice(d,1)},b.prototype.resetDependencies=function(a){this.depends.each(function(b,c){var d=c.indexOf(a);d!==-1&&c.splice(d,1)})};var d=new b;return a.addListener(a.events.PluginLoaded,function(b){var c=a.getModel(b);c&&c.addListener(a.events.Removing,function(a){d.clearDependencies(a)})}),a.depends.add=function(a,b){a&&b&&d.addDependency(a,b)},a.depends.check=function(b){var e=d.getDependencies(b,!0),f=e.length===0;if(!f){var g=c(e),h=a.ui.createDependencyDialog(g);h.dialog("open")}return f},a.depends.clear=function(a){d.clearDependencies(a)},a.depends.remove=function(a,b){a&&b&&d.removeDependency(a,b)},a.depends.reset=function(a){d.resetDependencies(a)},a}(editor||{}),function(a){function c(){var a=this;this.types=new Hashtable,this.functions=new Hashtable,this.parameters=new Hashtable,this.messages=new Hashtable;try{hemi.loader.loadHtml("js/editor/data/hemi.json",function(b){var c=JSON.parse(b);for(var d=0,e=c.length;d<e;d++){var f=c[d],g=f.name,h=f.funcs,i=f.msgs,j={description:f.desc,methods:[],parent:f.parent};a.types.put(g,j);for(var k=0,l=h.length;k<l;k++){var m=h[k],n=m.name,o=m.params,p={description:m.desc,parameters:[]};j.methods.push(n),a.functions.put(g+"."+n,p);for(var q=0,r=o.length;q<r;q++){var s=o[q],t=s.name;p.parameters.push(t),a.parameters.put(g+"."+n+"."+t,{description:s.desc,type:s.type})}}for(var k=0,l=i.length;k<l;++k){var u=i[k];a.messages.put(g+"."+u.name,u.desc)}}})}catch(b){hemi.console.log(b)}}function d(a){var b=a.join("."),c=this.types.get(b);return c==null&&(c=this.functions.get(b)),c==null&&(c=this.parameters.get(b)),c}a.data=a.data||{};var b=function(){c.call(this)};getDescription=function(a,b,c){var e=this.getParent(a),f=[];for(var g=0,h=arguments.length;g<h;++g)f[g]=arguments[g];var i=d.call(this,f);while(i==null&&e!=null)f[0]=e,e=this.getParent(e),i=d.call(this,f);return i==null?null:i.description},getMsgDescription=function(a,b){var c=this.getParent(a),d=this.messages.get(a+"."+b);while(d==null&&c!=null)d=this.messages.get(c+"."+b),c=this.getParent(c);return d},getMethods=function(a){var b=[];while(a!=null){var c=this.types.get(a);c?(b=b.concat(c.methods),a=c.parent):a=null}return b},getParameters=function(a,b){var c=this.functions.get(a+"."+b),d=this.getParent(a);while(c==null&&d!=null)c=this.functions.get(d+"."+b),d=this.getParent(d);return c?c.parameters:null},getParent=function(a){var b=this.types.get(a);return b?b.parent:null},getType=function(a,b,c){var e=this.getParent(a),f=[];for(var g=0,h=arguments.length;g<h;++g)f[g]=arguments[g];var i=d.call(this,f);while(i==null&&e!=null)f[0]=e,e=this.getParent(e),i=d.call(this,f);return i==null?null:i.type};var e=new b;a.data.getMetaData=function(){return e}}(editor),function(a){"use strict",a.ui=a.ui||{},a.ui.ComponentDefaults={uiFile:null,showOptions:null,hideOptions:null};var b=a.ui.Component=function(b){a.utils.Listenable.call(this),this.config=jQuery.extend({},a.ui.ComponentDefaults,b),this.container=null,this.visible===undefined&&(this.visible=!1),this.config.uiFile&&this.config.uiFile!==""?this.load():(this.layout(),this.finishLayout(),this.notifyListeners(a.events.Loaded))};b.prototype=new a.utils.Listenable,b.prototype.constructor=b,b.prototype.layout=function(){},b.prototype.finishLayout=function(){},b.prototype.load=function(){var b=this;this.container=jQuery("<div></div>"),this.config.uiFile&&this.config.uiFile!==""&&hemi.loadHtml(this.config.uiFile,function(c){var d=c.replace(/<!--(.|\s)*?-->/,"");b.container.append(jQuery(d)),b.layout(),b.finishLayout(),b.notifyListeners(a.events.Loaded)})},b.prototype.getUI=function(){return this.container},b.prototype.setVisible=function(a){a?this.container.show(this.config.showOptions):this.container.hide(this.config.hideOptions)},b.prototype.isVisible=function(){return this.container.is(":visible")},b.prototype.find=function(a){return this.container.find(a)}}(editor),function(a){function d(){var a;switch(this.config.type){case"number":a=parseFloat(this.container.val()),isNaN(a)&&(a=null);break;case"integer":a=parseInt(this.container.val()),isNaN(a)&&(a=null);break;case"boolean":a=this.container.prop("checked");break;case"angle":var b=parseFloat(this.container.val());a=hemi.core.math.degToRad(b),isNaN(a)&&(a=null);break;default:a=this.container.val(),a===""&&(a=null)}return a}function e(a){if(a==null)switch(this.config.type){case"boolean":this.container.prop("checked",!1);break;default:this.container.val("")}else switch(this.config.type){case"boolean":this.container.prop("checked",a);break;case"angle":var b=hemi.core.math.radToDeg(a);this.container.val(b);break;default:this.container.val(a)}}"use strict",a.ui=a.ui||{};var b={container:null,inputClass:null,onBlur:null,placeHolder:null,type:"number",validator:null},c=a.ui.Input=function(c){var d=jQuery.extend({},b,c);this.value=null,a.ui.Component.call(this,d)};c.prototype=new a.ui.Component,c.prototype.constructor=c,c.prototype.layout=function(){var a=this;if(this.config.container)this.container=this.config.container,this.config.placeHolder||(this.config.placeHolder=this.container.attr("placeholder"));else switch(this.config.type){case"boolean":this.container=jQuery('<input type="checkbox" />');break;default:this.container=jQuery('<input type="text" />')}this.config.placeHolder&&this.container.attr("placeholder",this.config.placeHolder),this.config.inputClass&&this.container.attr("class",this.config.inputClass),this.config.validator&&this.config.validator.setElements(this.container),this.container.bind("blur",function(b){var c=d.call(a);a.setValue(c),a.config.onBlur&&a.config.onBlur(a,b)}).bind("focus",function(b){e.call(a,a.value)})},c.prototype.getValue=function(){return this.container.is(":focus")||this.config.type==="boolean"?d.call(this):this.value},c.prototype.reset=function(){this.value=null,e.call(this,null)},c.prototype.setName=function(a){this.config.placeHolder=a,this.container.attr("placeholder",a),this.setValue(this.value)},c.prototype.setType=function(a){this.config.type=a},c.prototype.setValue=function(a){if(a==null)this.reset();else{this.value=a;switch(this.config.type){case"boolean":this.container.prop("checked",a);break;case"angle":a=hemi.core.math.radToDeg(a);default:this.config.placeHolder?this.container.val(this.config.placeHolder+": "+a):this.container.val(a)}}}}(editor),function(a){"use strict",a.ui=a.ui||{},a.ui.Constants=a.ui.Constants||{},a.ui.Constants.UP_STATE="UP",a.ui.Constants.DOWN_STATE="DOWN",a.ui.MenuItemDefaults={title:null,action:null,stateful:!1,stateDownClass:"down",stateUpClass:"up"};var b=a.ui.MenuItem=function(b){var c=jQuery.extend({},a.ui.MenuItemDefaults,b);a.ui.Component.call(this,c),this.stateful=c.stateful,this.setState(a.ui.Constants.UP_STATE),this.downClass=c.stateDownClass,this.upClass=c.stateUpClass};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=jQuery("<a></a>"),this.config.title&&this.setTitle(this.config.title),this.config.action&&this.setAction(this.config.action)},b.prototype.setTitle=function(a){this.container.text(a)},b.prototype.setKeyboardShortcut=function(a){},b.prototype.setAction=function(b){var c=this;this.container.bind("click",function(d){b(d),c.notifyListeners(a.events.MenuItemClicked,c),c.toggleState()})},b.prototype.setState=function(b){if(this.stateful)if(b==a.ui.Constants.DOWN_STATE||b==a.ui.Constants.UP_STATE){var c,d;b==a.ui.Constants.DOWN_STATE?(c=this.upClass,d=this.downClass):(c=this.downClass,d=this.upClass),this.state=b,this.container.removeClass(c).addClass(d)}else alert(b+" is an improper state")},b.prototype.toggleState=function(){this.stateful&&this.setState(this.state==a.ui.Constants.DOWN_STATE?a.ui.Constants.UP_STATE:a.ui.Constants.DOWN_STATE)};var c=a.ui.Menu=function(a,c){var d=this;this.menuItems=[],this.shown=!1,this.enabled=!0,b.call(this),a&&this.setTitle(a),c||this.setAction(function(a){if(d.shown)d.hide(),jQuery(document).unbind("click.menu");else{var b=0;jQuery(".ui-dialog").each(function(){var a=parseInt(jQuery(this).css("zIndex"));b=a>b?a:b}),d.show(),d.list.css("zIndex",b+1),jQuery(document).bind("click.menu",function(a){var b=jQuery(a.target),c=b.parents(".uiMenu");c.size()==0&&d.hide()})}})};c.prototype=new b,c.prototype.constructor=c,c.prototype.layout=function(){this.container=jQuery('<div class="uiMenu"></div>'),this.titleLink=jQuery("<span></span>"),this.list=jQuery("<ul></ul>"),this.listItem=jQuery("<li></li>"),this.container.append(this.titleLink).append(this.list),this.list.hide()},c.prototype.addMenuItem=function(b){if(b instanceof a.ui.MenuItem){var c=this.listItem.clone(),d=this;c.append(b.getUI()),this.list.append(c),this.menuItems.push(b),b.addListener(a.events.MenuItemClicked,function(a){d.hide()})}else alert("Must be a menu item "+b.getUI.html())},c.prototype.setTitle=function(a){this.titleLink.text(a).attr("id","uiMenuItem_"+a)},c.prototype.setAction=function(a){var b=this;this.titleLink.bind("click",function(c){b.enabled&&a(c)})},c.prototype.setEnabled=function(a){this.enabled=a},c.prototype.hide=function(){this.list.fadeOut(200),this.shown=!1,this.titleLink.removeClass("uiMenuShown")},c.prototype.show=function(){this.list.fadeIn(200),this.shown=!0,this.titleLink.addClass("uiMenuShown")};var d=a.ui.PopupMenu=function(a){c.call(this,a,!0)},e=c.prototype;d.prototype=new c,d.prototype.constructor=d,d.prototype.finishLayout=function(){e.finishLayout.call(this),this.container.css({zIndex:a.ui.Layer.MENU}).hide(),this.list.show()},d.prototype.hide=function(){this.container.fadeOut(200),this.shown=!1,jQuery(document).unbind("click.menu"),this.parent.removeClass("uiMenuShown"),this.parent=null},d.prototype.show=function(a,b){jQuery(document).bind("click.menu",function(a){var d=jQuery(a.target),e=d.parents(".uiMenu");e.size()==0&&d[0]!=b[0]&&c.hide()}),this.container.css({top:a.top,left:a.left}).fadeIn(200),this.shown=!0;var c=this;this.parent=b,b.addClass("uiMenuShown")}}(editor),function(a){"use strict",a.ui=a.ui||{},a.ui.ColorPickerDefaults={container:null,inputId:"color",buttonId:"colorPicker",containerClass:""};var b=a.ui.ColorPicker=function(b){var c=jQuery.extend({},a.ui.ColorPickerDefaults,b);a.ui.Component.call(this,c)};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=jQuery("<div></div>"),this.container.addClass(this.config.containerClass),this.rInput=jQuery('<input type="text" id="'+this.config.inputId+'R" class="rNdx color" placeholder="r" disabled />'),this.gInput=jQuery('<input type="text" id="'+this.config.inputId+'G"  class="gNdx color" placeholder="g" disabled />'),this.bInput=jQuery('<input type="text" id="'+this.config.inputId+'B"  class="bNdx color" placeholder="b" disabled />'),this.aInput=jQuery('<input type="text" id="'+this.config.inputId+'A"  class="aNdx color" placeholder="a" disabled />'),this.hex=0,this.pickerBtn=jQuery('<span id="'+this.config.buttonId+'" class="colorPicker"></span>'),this.container.append(this.rInput).append(this.gInput).append(this.bInput).append(this.aInput).append(this.pickerBtn),this.setupColorPicker()},b.prototype.setupColorPicker=function(){var b=this.rInput,c=this.gInput,d=this.bInput,e=this.aInput,f=this.pickerBtn,g=a.ui.Layer.DIALOG,h=this,i={window:{expandable:!0,alphaSupport:!0,position:{x:"left",y:"center"},effects:{type:"fade",speed:{show:"fast"}}},images:{clientPath:"js/lib/jpicker/images/"},color:{active:"#ffffff"}},j=function(f){var g=a.utils.roundNumber;b.val(g(f.val("r")/255,2)),c.val(g(f.val("g")/255,2)),d.val(g(f.val("b")/255,2)),e.val(g(f.val("a")/255,2)),h.hex=f.val("hex");var i=[parseFloat(b.val()),parseFloat(c.val()),parseFloat(d.val()),parseFloat(e.val())];return i};f.jPicker(i,function(b,c){var d=j(b);h.notifyListeners(a.events.ColorPicked,d)});var k=!1,l=jQuery.jPicker.List;for(var m=0,n=l.length;m<n&&!k;m++){var o=l[m];jQuery(o).attr("id")===this.config.buttonId&&(this.picker=o,k=!0)}setTimeout(function(){jQuery("div.jPicker.Container:last.Move").text("Color Picker"),jQuery(h.picker).siblings(".jPicker").bind("click",function(a){var b=jQuery(this),c=i.window;jQuery("div.jPicker.Container").each(function(){var a=jQuery(this);if(parseInt(a.css("zIndex"))===10)a.css({zIndex:g});else{var d=c.position.x=="left"?b.offset().left-530-(c.position.y=="center"?25:0):c.position.x=="center"?b.offset().left-260:c.position.x=="right"?b.offset().left-10+(c.position.y=="center"?25:0):c.position.x=="screenCenter"?($(document).width()>>1)-260:b.offset().left+parseInt(c.position.x),e=c.position.y=="top"?b.offset().top-312:c.position.y=="center"?b.offset().top-156:c.position.y=="bottom"?b.offset().top+25:b.offset().top+parseInt(c.position.y);a.css({zIndex:g+1,left:Math.max(d,0)+"px",position:"absolute",top:Math.max(e,0)+"px"})}})}),jQuery("div.jPicker.Container:last").unbind("mousedown").bind("mousedown",function(){jQuery("div.jPicker.Container").each(function(){jQuery(this).css({zIndex:g})}),jQuery(this).css({zIndex:g+1})})},0)},b.prototype.setColor=function(a){this.rInput.val(a[0]),this.gInput.val(a[1]),this.bInput.val(a[2]),this.aInput.val(a[3]),this.picker.color.active.val("rgba",{r:a[0]*255,g:a[1]*255,b:a[2]*255,a:a[3]*255})},b.prototype.setColorHex=function(a,b){var c=jQuery.jPicker.ColorMethods,d=(typeof a=="number"?a.toString(16):a)+c.intToHex(b*255),e=c.hexToRgba(d);this.rInput.val(e.r/255),this.gInput.val(e.g/255),this.bInput.val(e.b/255),this.aInput.val(b),this.picker.color.active.val("rgba",{r:e.r,g:e.g,b:e.b,a:e.a})},b.prototype.getColor=function(){var a=this.rInput.val(),b=this.gInput.val(),c=this.bInput.val(),d=this.aInput.val(),e=null;return a!==""&&b!==""&&c!==""&&d!==""&&(a=parseFloat(a),b=parseFloat(b),c=parseFloat(c),d=parseFloat(d),isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d)||(e=[a,b,c,d])),e},b.prototype.getColorHex=function(){return parseInt(this.hex,16)},b.prototype.getAlpha=function(){var a=this.aInput.val();if(a!=="")return parseFloat(a)},b.prototype.reset=function(){this.rInput.val(""),this.gInput.val(""),this.bInput.val(""),this.aInput.val(""),this.picker.color.active.val("hex","#ffffff")}}(editor),function(a){function c(a){var b=jQuery('<div class="vectorVec"></div>'),c=jQuery("<button>Add</button>"),e=d.call(this),f=this;return c.bind("click",function(){var a=jQuery(this),b=a.data("ndx"),c=d.call(f);f.inputs[b].push(c),a.before(c.container)}).data("ndx",a),b.append(e.container).append(c),{div:b,inputs:[e]}}function d(b){var c=this.config;return new a.ui.Input({inputClass:c.type,onBlur:c.onBlur,placeHolder:b,type:c.inputType,validator:c.validator})}function e(){var a=[],b=!0;for(var c=0,d=this.inputs.length;c<d&&b;c++){var e=this.inputs[c],f=e.elem.getValue();b=f!==""&&f!==null;if(b)if(this.multiDim){var g=a[e.ndx1];g==null&&(g=a[e.ndx1]=[]),g[e.ndx2]=f}else a[e.ndx1]=f}return b?a:null}function f(){var a=[],b=!0,c=function(a){var b=obj.elem.getValue();return b===""&&(b=null),b};for(var d=0,e=this.inputs.length;d<e&&b;d++){var f=this.inputs[d];if(jQuery.isArray(f)){var g=[];for(var h=0,i=f.length;h<i&&b;h++){var j=c(f[h]);g.push(j),b=j!=null}a.push(g)}else{var j=c(f);a.push(j),b=j!=null}}return b?a:null}function g(){var a=this.config.inputs,b=a.length,c=!1;b===1&&hemi.utils.isNumeric(a[0])&&(b=a[0],c=!0);for(var e=0;e<b;e++){var f=a[e];if(this.multiDim){var g=jQuery('<div class="vectorVec"></div>');f.length===1&&hemi.utils.isNumeric(f[0])&&(jl=f[0],c=!0);for(var h=0;h<jl;h++){var j=f[h],k=d.call(this,c?null:j);this.inputs.push({ndx1:e,ndx2:h,key:j,elem:k}),g.append(k.container)}this.container.append(g)}else{var k=d.call(this,c?null:f);this.inputs.push({ndx1:e,key:f,elem:k}),this.container.append(k.container)}}i.call(this)}function h(){var a=this,b=0;this.addBtn=jQuery("<button>Add</button>");do{if(this.multiDim){var e=c.call(this,b);this.inputs.push(e.inputs),this.container.append(e.div)}else{var f=d.call(this);this.inputs.push(f),this.container.append(f.container)}b++}while(b<this.config.inputs.length);this.addBtn.bind("click",function(){var b=jQuery(this),e=b.data("ndx");if(a.multiDim){var f=c.call(a,e);a.inputs.push(f.inputs),b.before(f.div)}else{var g=d.call(this);this.inputs.push(g),b.before(g.container)}b.data("ndx",e+1)}).data("ndx",b),this.container.append(this.addBtn)}function i(){var a=this,b=a.find("."+this.config.type);b.bind("keydown",function(a){var b=jQuery(this);b.removeClass("vectorHelper")}).bind("blur",function(b){var c=jQuery(this),d=a.getValue();a.config.onBlur&&a.config.onBlur(c,b,a)})}function j(a){var b=this.inputs;if(jQuery.isArray(a)){var c=function(a,c){var d=null;for(var e=0,f=b.length;e<f&&d==null;e++){var g=b[e],h=g.ndx2!=null;if(h&&g.ndx1===a&&g.ndx2===c||!h&&g.ndx1===a)d=g}return d};for(var d=0,e=a.length;d<e;d++){var f=a[d];if(this.multiDim)for(var g=0,h=f.length;g<h;g++){var i=f[g];c(d,g).elem.setValue(i)}else c(d).elem.setValue(f)}}else for(var j in a){var k=-1;for(var d=0,e=b.length;d<e&&k===-1;d++)b[d].key==j&&(k=d);var l=b[k].elem;l&&(l.setValue(a[j]),l.container.removeClass("vectorHelper"))}}function k(a){this.container.find(".vectorVec").remove(),this.inputs=[];for(var b=0,e=a.length;b<e;b++){var f=this.inputs[b],g=a[b],h=jQuery.isArray(g);if(f==null)if(h){var i=c.call(this,b);f=this.inputs[b]=i.inputs,this.addBtn.before(i.div),f.div=i.div}else f=this.inputs[b]=d.call(this),this.addBtn.before(f.container);if(h)for(var j=0,k=g.length;j<k;j++){var l=g[j],m=f[j];m==null&&(m=f[j]=d.call(this)),m.setValue(l),f.div.find("button").before(m.container)}else f.setValue(a[b])}}function l(a,b){var c=jQuery.inArray(a,b)!==-1;if(!c)for(var d=0,e=b.length;d<e&&!c;d++){var f=b[d];if(jQuery.isArray(f))c=jQuery.inArray(a,f)!==-1;else break}return c}"use strict",a.ui=a.ui||{},a.ui.VectorDefaults={container:null,inputs:["x","y","z"],type:"vector",inputType:"number",onBlur:null,validator:null};var b=a.ui.Vector=function(b){var c=jQuery.extend({},a.ui.VectorDefaults,b),d=c.inputs;this.unbounded=d.length===0,this.multiDim=jQuery.isArray(d[0]),this.multiDimUnbounded=this.multiDim&&d[0].length===0,this.inputs=[],a.ui.Component.call(this,c)};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=this.config.container,this.unbounded||this.multiDimUnbounded?h.call(this):g.call(this),this.validator=new a.ui.VectorValidator(this)},b.prototype.setValue=function(a){this.unbounded||this.multiDimUnbounded?k.call(this,a):j.call(this,a)},b.prototype.getValue=function(){return this.unbounded||this.multiDimUnbounded?f.call(this):e.call(this)},b.prototype.reset=function(){for(var a=0,b=this.inputs.length;a<b;++a)this.inputs[a].elem.reset()},b.prototype.setInputName=function(a,b,c){var d=!1;for(var e=0,f=this.inputs.length;e<f&&!d;++e){var g=this.inputs[e];g.ndx1===b&&g.ndx2==c&&(g.elem.setName(a),d=!0)}return d},b.prototype.setInputType=function(a){for(var b=0,c=this.inputs.length;b<c;++b)this.inputs[b].elem.setType(a)}}(editor||{}),function(a){"use strict",a.ui=a.ui||{};var b=0;a.ui.TreeSelectorDefaults={containerClass:"",panelHeight:400,tree:null,select:null};var c=a.ui.TreeSelector=function(c){var d=jQuery.extend({},a.ui.TreeSelectorDefaults,c);this.eventName="click.treeSelector"+b,this.buttonId="treeSelectorBtn"+b,this.inputId="treeSelectorIpt"+b,this.panelId="treeSelectorPnl"+b++,a.ui.Component.call(this,d)};c.prototype=new a.ui.Component,c.prototype.constructor=c,c.prototype.layout=function(){var a=this,b=function(b){var c=a.input,d=a.picker,e=a.panel;if(e.is(":visible"))a.hidePanel(),jQuery(document).unbind(a.eventName),e.data("docBound",!1),d.removeClass("open"),c.removeClass("open");else{var f=e.data("docBound");c.addClass("open"),d.addClass("open"),width=c.outerWidth()+d.outerWidth()-a.treeBorder-a.treePadding,a.showPanel(width),f||(jQuery(document).bind(a.eventName,function(b){var c=jQuery(b.target),d=c.parents("#"+a.panelId),e=c.attr("id");d.size()==0&&e!=a.panelId&&e!=a.inputId&&e!=a.buttonId&&a.hidePanel()}),e.data("docBound",!0))}};this.container=jQuery('<div class="treeSelector"></div>'),this.input=jQuery('<input type="text" id="'+this.inputId+'" class="treeSelectorIpt" readonly="readonly" placeholder="Select an item" />'),this.picker=jQuery('<button id="'+this.buttonId+'" class="treeSelectorBtn">Selector</button>');var c=this.panel=jQuery('<div id="'+this.panelId+'" class="treeSelectorPnl"></div>');this.treeBorder=Math.ceil(parseFloat(c.css("borderRightWidth")))+Math.ceil(parseFloat(c.css("borderLeftWidth"))),this.treePadding=Math.ceil(parseFloat(c.css("paddingLeft")))+Math.ceil(parseFloat(c.css("paddingRight"))),this.selFcn=function(b,c){if(a.config.select)a.config.select(c,a)&&(a.picker.removeClass("selected"),a.hidePanel());else{var d=c.rslt.obj,e=d.find("a").text();a.input.val(e),a.hidePanel(),a.picker.removeClass("selected"),a.setSelection(e)}},this.config.tree?this.setTree(this.config.tree):this.input.attr("placeholder","No items to select"),this.container.addClass(this.config.containerClass),jQuery("body").append(this.panel),this.container.append(this.input).append(this.picker),this.panel.css({maxHeight:this.config.panelHeight,position:"absolute"}).hide(),this.input.bind("click",b),this.picker.bind("click",b)},c.prototype.getSelection=function(){return this.input.data("selectObj")},c.prototype.hidePanel=function(){this.panel.slideUp(200),this.input.removeClass("open"),this.picker.removeClass("open")},c.prototype.reset=function(){this.input.val(""),this.input.removeData("selectObj"),this.tree.jstree("deselect_all")},c.prototype.select=function(a){var b=jQuery("#"+a);this.tree.jstree("select_node",b)},c.prototype.setSelection=function(a){this.input.data("selectObj",a)},c.prototype.setTree=function(a){this.tree=a,a.bind("select_node.jstree",this.selFcn).addClass("treeSelectorTree"),this.panel.append(a)},c.prototype.showPanel=function(a){var b=this.input.offset(),a=a||this.container.width();b.top+=this.input.outerHeight(),this.panel.css({top:b.top,left:b.left}).width(a).slideDown(200)}}(editor),function(a){"use strict",a.ui=a.ui||{};var b=function(b){var c=jQuery.extend({cls:"",mouseHide:!0},b);a.ui.Component.call(this,c),this.id=0,this.currentElement=null};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){var a=this,b=function(){a.isAnimating||a.hide(0)};this.container=jQuery('<div class="tooltip '+this.config.cls+'"></div>'),this.msg=jQuery('<div class="content"></div>'),this.arrow=jQuery('<div class="arrow"></div>'),this.container.append(this.msg),this.config.mouseHide&&this.container.bind("mouseenter",b).bind("mouseleave",b),this.msg.css("borderLeftWidth")!==0?(this.arrow.addClass("outer"),this.innerArrow=jQuery('<div class="innerArrow"></div>'),this.msg.before(this.arrow),this.container.append(this.innerArrow)):this.container.append(this.arrow),this.container.hide(),this.isVisible=!1},b.prototype.show=function(a,b,c,d){var e=this.container,f=this,g=jQuery.extend({top:0,left:0},d);this.currentElement=a,this.container.parents().size()===0&&jQuery("body").append(this.container),jQuery.type(b)=="string"?this.msg.text(b):this.msg.empty().append(b),e.show();var h=a.offset(),i=e.outerHeight(!0),j=e.outerWidth(!0),k=a.width()/2,l=a.height(),m=h.top-i<0,n=this.arrow.outerHeight(),o=this.arrow.outerWidth()/2,p=o>k?5:k-o,q=window.innerWidth?window.innerWidth:document.documentElement.offsetWidth,r=jQuery(window).height(),s=j+h.left>q?h.left-(q-j):0,t=m?h.top+l+n+g.top:h.top-i-g.top,u=m?r-(h.top+l+n+g.top+i):r-(h.top-g.top);e.css({bottom:u-20,left:h.left-s}),m?(this.innerArrow.addClass("top"),this.arrow.addClass("top")):(this.innerArrow.removeClass("top"),this.arrow.removeClass("top")),this.innerArrow.css({left:p}),this.arrow.css({left:p});if(!this.isAnimating){var v=jQuery(document),w=function(a){if(f.currentElement){var b=f.currentElement[0],c=a.target,d=jQuery(c).parent()[0];c!==b&&d!==b&&f.hide(0)}v.unbind("mousemove",w)};this.isAnimating=!0,e.css("opacity",0).animate({opacity:1,bottom:"+=20"},200,function(){f.isAnimating=!1,f.isVisible=!0,v.bind("mousemove",w)})}c!=null&&this.hideTimer(!0,c)},b.prototype.hide=function(a){this.hideTimer(!1,a)},b.prototype.hideTimer=function(a,b){var c=this,d=this.id,e=b==null?2e3:b;a&&(d=this.id+=1),setTimeout(function(){c.hideMessage(d)},e)},b.prototype.hideMessage=function(a){if(this.id===a){var b=this.container,c=this;b.animate({opacity:0,bottom:"+=20"},200,function(){b.hide(),c.isVisible=!1,c.currentElement=null})}},a.ui.createTooltip=function(a){return new b(a)}}(editor),function(a){function e(a){return a===""||hemi.utils.isNumeric(a)}function f(a,b,c){var d=parseFloat(a);return a===""||(b!=null&&c!=null?d>=b&&d<=c:b!=null&&c==null?d>=b:d<=c)}"use strict",a.ui=a.ui||{};var b=new a.ui.createTooltip({cls:"errorWrapper"}),c=a.ui.Validator=function(b,c){a.utils.Listenable.call(this),this.checkFunction=c,this.containerClass="errorWrapper",b!=null&&this.setElements(b)};c.prototype=new a.utils.Listenable,c.prototype.constructor=c,c.prototype.setElements=function(a){var c=this;a.bind("change.errEvt",function(a){var d=jQuery(this),e=null;e=c.checkFunction(d),e?(b.show(d,e,2e3),d.addClass("error")):(b.hide(),d.removeClass("error"))})};var d=a.ui.VectorValidator=function(c){a.utils.Listenable.call(this),this.containerClass="errorWrapper",this.timeoutId=null,this.vector=c;var d=c.find("."+c.config.type),e=this;d.bind("focus",function(a){e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null)}).bind("blur",function(a){var c=e.vector.inputs,f=c[0].elem.getValue(),g=f===""||f===null,h=null;for(var i=1,j=c.length;i<j&&!h;i++){var k=c[i].elem.getValue(),l=k===""||k===null;l!==g&&(h="must fill out all values")}h?e.timeoutId=setTimeout(function(){e.timeoutId=null,b.show(e.vector.getUI(),h,3e3),d.addClass("error")},1500):(b.hide(),d.removeClass("error"))})};return d.prototype=new a.utils.Listenable,d.prototype.constructor=d,a.ui.createDefaultValidator=function(b,c){var d=new a.ui.Validator(null,function(a){var b=a.val(),c=null;return e(b)?(this.min!=null||this.max!=null)&&!f(b,this.min,this.max)&&(c=this.min!=null&&this.max!=null?"must be between "+this.min+" and "+this.max:this.min!=null?"must be greater than or equal to "+this.min:"must be less than or equal to "+this.max):c="must be a number",c});return d.min=b,d.max=c,d},a}(editor||{},jQuery),function(a){"use strict",a.ui=a.ui||{},a.ui.ListType={UNORDERED:0,ORDERED:1},a.ui.ListDefaults={id:"",cssClass:"",prefix:"lst",type:a.ui.ListType.UNORDERED,sortable:!1};var b=a.ui.List=function(b){var c=jQuery.extend({},a.ui.ListDefaults,b);a.ui.Component.call(this,c),this.list,this.listItemTemplate,this.idCounter=0,this.listItems=new Hashtable};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.add=function(a){this.list.append(this.createListItem(a)),a.setParent(this)},b.prototype.after=function(a,b){b.getUI().parent().after(this.createListItem(a)),a.setParent(this)},b.prototype.before=function(a,b){b.getUI().parent().before(this.createListItem(a)),a.setParent(this)},b.prototype.clear=function(){this.list.empty(),this.listItems.clear()},b.prototype.createListItem=function(a){var b=jQuery("<li></li>"),c=this.config.prefix+"LstItm-"+this.idCounter;return b.attr("id",c).append(a.getUI()),b.data("obj",a),this.listItems.put(a,b),this.idCounter+=1,b},b.prototype.edit=function(a,b,c){var d=this.list.find("#"+a),e=d.data("obj");e.attachObject(b),e.setText(c)},b.prototype.layout=function(){this.container=this.list=this.config.type==a.ui.ListType.UNORDERED?jQuery('<ul class="listWidget"></ul>'):jQuery('<ol class="listWidget"></ol>'),this.list.attr("id",this.config.id).addClass(this.config.cssClass),this.config.sortable&&this.list.sortable()},b.prototype.makeSortable=function(){this.list.sortable()},b.prototype.remove=function(b){var c=null;if(typeof b=="string"){c=this.list.find("#"+b);var d=c.data("obj");d.setParent(null),this.listItems.remove(d)}else b instanceof a.ui.ListItem&&(c=this.listItems.remove(b));c!==null&&c.remove()};var c=a.ui.ListItem=function(b){a.ui.Component.call(this,b)};c.prototype=new a.ui.Component,c.prototype.constructor=c,c.prototype.attachObject=function(a){this.container.data("obj",a)},c.prototype.data=function(a,b){return b!=null?this.container.data(a,b):this.container.data(a)},c.prototype.layout=function(){this.container=jQuery("<div></div>")},c.prototype.getAttachedObject=function(){return this.container.data("obj")},c.prototype.getId=function(){return this.container.parent().attr("id")},c.prototype.getText=function(){return this.container.text()},c.prototype.remove=function(){this.container.remove()},c.prototype.removeObject=function(){this.container.data("obj",null)},c.prototype.setId=function(a){this.container.parent().attr("id",a)},c.prototype.setParent=function(a){this.parent=a},c.prototype.setText=function(a){this.container.text(a)},a.ui.EdtLiWgtDefaultOptions={removable:!0,editable:!0};var d=a.ui.EditableListItem=function(b){var c=jQuery.extend({},a.ui.EdtLiWgtDefaultOptions,b);a.ui.ListItem.call(this,c)},e=a.ui.ListItem.prototype;d.prototype=new a.ui.ListItem,d.prototype.constructor=d,d.prototype.layout=function(){e.layout.call(this);var a=jQuery('<div class="buttonContainer"></div>');this.title=jQuery("<span></span>"),this.config.editable&&(this.editBtn=jQuery('<button class="editBtn">Edit</button>'),a.append(this.editBtn)),this.config.removable&&(this.removeBtn=jQuery('<button class="removeBtn">Remove</button>'),a.append(this.removeBtn)),this.container.append(this.title).append(a)},d.prototype.getText=function(){return this.title.text()},d.prototype.setText=function(a){this.title.text(a)}}(editor),function(a){function h(a,b,c,d){var e=a?0:b,f=a?b:0;d.opacity=f,c.css("opacity",e),a&&c.show()}function i(b,c){var d=this.container,e;switch(this.config.location){case a.ui.Location.TOP:e="top";break;case a.ui.Location.BOTTOM:e="bottom";break;case a.ui.Location.RIGHT:e="right";break;default:e="left"}var f=parseInt(d.css(e)),g="+="+(b-f);c[e]=g}function j(b,c){var d=this.container,e=this.minMaxBtn,f={},g=b?0:-20,j;switch(this.config.location){case a.ui.Location.TOP:j="top";break;case a.ui.Location.BOTTOM:j="bottom";break;case a.ui.Location.RIGHT:j="right";break;default:j="left"}if(b)e.data("min")||d.bind("mouseenter",l).bind("mouseleave",k),e.data("min",!0).text("Min").hide();else{var m=parseInt(d.css(j));c=c||m<g}c?b?(d.css(j,g).css("opacity",this.origOpacity).show(),e.css(j,g)):(d.css(j,g).css("opacity",0).hide(),e.css(j,g)):(h(b,this.origOpacity,d,f,d),i.call(this,g,f),d.animate(f,function(){b||d.hide()}))}function k(a){var b=jQuery(this).find("button.minMax"),c={};h(!1,b.data("origOpacity"),b,c),b.animate(c,function(){b.hide()})}function l(a){var b=jQuery(this).find("button.minMax"),c={};h(!0,b.data("origOpacity"),b,c),b.animate(c)}function x(){var a=jQuery("body"),b=jQuery(window),c=jQuery(".mainView"),d=b.width(),e=b.height();d<=1024?(a.addClass("ten24"),d=1024):a.removeClass("ten24"),e<=728&&(e=728,a.hasClass("ten24")||a.addClass("ten24")),c.width(d),c.height(e);for(var g=0,h=f.length;g<h;g++)f[g].resize();var i=c.find("canvas");i.attr("width",d),i.attr("height",e)}"use strict",a.ui=a.ui||{},a.ui.Layer={TOOL:500,TOOLBAR:600,DIALOG:700,MENU:800},a.ui.Location={TOP:0,RIGHT:1,BOTTOM:2},a.ui.Height={FULL:0,HALF:1,THIRD:2,MANUAL:3};var b=50,c=1,d=1e4,e=.5,f=[],g=function(b){var c=jQuery.extend({location:a.ui.Location.RIGHT,classes:[],minMax:!0,startsVisible:!0},b);this.minMaxBtn=null,this.origOpacity=null,this.visible=!0,this.name=c.location===a.ui.Location.TOP?"topPanel":c.location===a.ui.Location.BOTTOM?"bottomPanel":"sidePanel",a.ui.Component.call(this,c),b.extending||f.push(this)};g.prototype=new a.ui.Component,g.prototype.constructor=g,g.prototype.layout=function(){var b=this.minMaxBtn=jQuery('<button class="minMax" style="position:absolute;"></button>'),c=this.container=jQuery("<div></div>"),d=this;jQuery("body").append(c),this.config.minMax&&c.append(b),c.css({zIndex:a.ui.Layer.TOOL}).bind("mouseenter",l).bind("mouseleave",k),b.bind("click",function(a){var c=b.data("min");c?d.minimize():d.maximize(),b.data("min",!c)}).data("origOpacity",1).data("min",!0).text("Min").hide();for(var e=0,f=this.config.classes.length;e<f;e++)c.addClass(this.config.classes[e]);switch(this.config.location){case a.ui.Location.RIGHT:c.addClass("rightAligned");break;case a.ui.Location.TOP:c.addClass("topAligned");break;case a.ui.Location.BOTTOM:c.addClass("bottomAligned")}this.origOpacity=c.css("opacity")},g.prototype.getName=function(){return this.name},g.prototype.getPreferredHeight=function(){return this.preferredHeight},g.prototype.isVisible=function(){return this.visible},g.prototype.maximize=function(){var a={},b=this.minMaxBtn,c=this;i.call(this,0,a),this.container.bind("mouseleave",k).bind("mouseenter",l).animate(a,function(){b.text("Min")}).removeClass("minimized")},g.prototype.minimize=function(){var b={},c=this.minMaxBtn,d=this,e;switch(this.config.location){case a.ui.Location.TOP:case a.ui.Location.BOTTOM:e=this.container.height();break;case a.ui.Location.RIGHT:default:e=this.container.width()}i.call(this,-1*e,b),this.container.unbind("mouseleave",k).unbind("mouseenter",l).animate(b,function(){c.text("Max")}).addClass("minimized")},g.prototype.resize=function(){var b=this.container.outerHeight(),c=this.container.outerWidth(),d=this.minMaxBtn.outerHeight(),e=this.minMaxBtn.outerWidth(),f=window.innerWidth?window.innerWidth:document.documentElement.offsetWidth,g=(f-c)/2;switch(this.config.location){case a.ui.Location.RIGHT:this.minMaxBtn.css({top:(b-d)/2,right:c});break;case a.ui.Location.TOP:this.container.css({left:g}),this.minMaxBtn.css({left:(c-e)/2,top:b});break;case a.ui.Location.BOTTOM:this.container.css({left:g}),this.minMaxBtn.css({left:(c-e)/2,bottom:b});break;default:this.minMaxBtn.css({top:(b-d)/2,left:c})}},g.prototype.setVisible=function(b,c){if(b!==this.visible){j.call(this,b,c),b||this.container.bind("mouseleave",k).bind("mouseenter",l).removeClass("minimized");var d=this;this.resize(),this.visible=b,this.notifyListeners(a.events.PanelVisible,{panel:d,visible:b})}};var m=function(){this.panes=new Hashtable,this.visiblePane=null,g.call(this,{location:3})},n=g.prototype;m.prototype=new g({extending:!0}),m.prototype.constructor=m,m.prototype.layout=function(){n.layout.call(this);var a=jQuery('<h1><span>World</span><span class="editor">Editor</span></h1>');this.list=jQuery("<ul></ul>"),this.container.attr("id","navBar").append(a).append(this.list),this.resize()},m.prototype.add=function(b,c){var d=jQuery("<li></li>"),e=b.getUI(),f=this;c!=null&&d.attr("id",c),d.append(e),e.find("a").bind("click",function(a){f.visiblePane&&f.visiblePane!==b&&f.visiblePane.setVisible(!1),b.setVisible(!b.isVisible()),b.isVisible()?f.visiblePane=b:f.visiblePane=null}),this.list.append(d),this.panes.put(b.title,{li:d,pane:b}),b.addListener(a.events.Enabled,function(a){var b=f.panes.get(a.item);a.enabled?b.li.show():b.pane.setVisible(!1,function(){b.li.hide()})})},m.prototype.get=function(a){var b=this.panes.get(a);return b!=null?b.pane:b};var o=a.ui.NavPane=function(b,c){this.toolbar=null,this.title=b,this.visible=!1,a.ui.Component.call(this,c)};o.prototype=new a.ui.Component,o.prototype.constructor=a.ui.NavPane,o.prototype.layout=function(){this.toolbarContainer=jQuery('<div class="toolbarContainer"></div>'),this.toolbarContainer.hide(),this.container=jQuery("<div></div>"),this.titleElem=jQuery('<h2><a href="#">'+this.title+"</a></h2>"),this.container.append(this.titleElem).append(this.toolbarContainer)},o.prototype.add=function(a){this.toolbar.add(a)},o.prototype.isVisible=function(){return this.visible},o.prototype.notify=function(b,c){switch(b){case a.events.Enabled:this.setEnabled(c.enabled)}},o.prototype.remove=function(a){this.toolbar.remove(a)},o.prototype.setEnabled=function(b){this.notifyListeners(a.events.Enabled,{item:this.title,enabled:b})},o.prototype.setToolBar=function(b){this.toolbar=b;var c=b.getUI();this.toolbarContainer.append(c),this.toolbar.addListener(a.events.Enabled,this)},o.prototype.setVisible=function(a,b){a?(this.toolbarContainer.slideDown(function(){b&&b()}),this.toolbar.loadState(),this.container.addClass("down"),this.visible=!0):(this.toolbarContainer.slideUp(function(){b&&b()}),this.toolbar.saveState(),this.container.removeClass("down"),this.visible=!1)};var p=a.ui.Panel=function(a){this.widgets=[],a=a||{},a.classes?a.classes.unshift("panel"):a.classes=["panel"],g.call(this,a)},q=g.prototype;p.prototype=new g({extending:!0}),p.prototype.constructor=p,p.prototype.finishLayout=function(){q.finishLayout.call(this),this.setVisible(!1,!0)},p.prototype.addWidget=function(a){this.container.append(a.getUI()),this[a.getName()]=a,this.widgets.push(a),a.setMinHeight(parseInt(this.container.css("min-height")))},p.prototype.resize=function(){q.resize.call(this);for(var a=0,b=this.widgets.length;a<b;a++)this.widgets[a].sizeAndPosition()},p.prototype.setVisible=function(a,b){if(a!==this.visible){q.setVisible.call(this,a,b);for(var c=0,d=this.widgets.length;c<d;c++)this.widgets[c].sizeAndPosition()}};var r=a.ui.FullPanel=function(a){a=a||{},a.minMax=!1,a.classes?a.classes.unshift("fullPanel"):a.classes=["fullPanel"],p.call(this,a)};r.prototype=new p({extending:!0}),r.prototype.constructor=r,a.ui.WidgetDefaults={classes:[],height:a.ui.Height.HALF,name:"defaultName"};var s=a.ui.Widget=function(b){var c=jQuery.extend({},a.ui.WidgetDefaults,b);c.classes?c.classes.unshift("widget"):c.classes=["widget"],this.minHeight=null,a.ui.Component.call(this,c)},t=a.ui.Component.prototype;s.prototype=new a.ui.Component,s.prototype.constructor=s,s.prototype.layout=function(){this.container||(this.container=jQuery("<div></div>"))},s.prototype.finishLayout=function(){for(var a=0,b=this.config.classes.length;a<b;a++)this.container.addClass(this.config.classes[a]);this.find("form").addClass("widgetForm").submit(function(){return!1}),this.sizeAndPosition()},s.prototype.getName=function(){return this.config.name},s.prototype.getPreferredHeight=function(){return this.preferredHeight},s.prototype.invalidate=function(){this.sizeAndPosition()},s.prototype.setMinHeight=function(a){this.minHeight=a},s.prototype.setVisible=function(b){t.setVisible.call(this,b);var c=this;this.notifyListeners(a.events.WidgetVisible,{widget:c,visible:b})},s.prototype.sizeAndPosition=function(){var b=this.container,c=parseInt(b.css("paddingBottom"))+parseInt(b.css("paddingTop")),d=jQuery(window),e=this.minHeight?Math.max(d.height(),this.minHeight):d.height();switch(this.config.height){case a.ui.Height.FULL:b.height(e-c);break;case a.ui.Height.HALF:b.height(e/2-c);break;case a.ui.Height.THIRD:b.height(e/3-c);break;case a.ui.Height.MANUAL:}b[0].scrollHeight>b.height()+c?b.addClass("hasScrollBar"):b.removeClass("hasScrollBar")};var u=a.ui.FormWidget=function(a){this.checkers=[],a=a||{},a.classes?a.classes.unshift("widgetWithForms"):a.classes=["widgetWithForms"],s.call(this,a)};u.prototype=new s,u.prototype.constructor=u,u.prototype.addInputsToCheck=function(b){var c=this;if(b instanceof a.ui.ColorPicker){var d={input:b,saveable:function(){return this.input.getColor()!=null}};this.checkers.push(d)}else if(b instanceof a.ui.Input||b instanceof a.ui.Vector){var d={input:b,saveable:function(){return this.input.getValue()!=null}};this.checkers.push(d)}else b instanceof a.ui.InputChecker?this.checkers.push(b):b.each&&b.each(function(a,b){var d=jQuery(b),e={input:d,saveable:function(){return this.input.val()!==""}};c.checkers.push(e)})},u.prototype.checkSaveable=function(){var a=this.checkers,b=!0;for(var c=0,d=a.length;c<d&&b;c++)b=a[c].saveable();return b},a.ui.InputChecker=function(a){this.input=a},a.ui.InputChecker.prototype={saveable:function(){}},a.ui.ListWidgetDefaults={name:"listSBWidget",listId:"list",prefix:"lst",title:"",instructions:"",type:a.ui.ListType.UNORDERED,sortable:!1};var v=a.ui.ListWidget=function(b){var c=jQuery.extend({},a.tools.ListWidgetDefaults,b);a.ui.Widget.call(this,c),this.items=new Hashtable},w=s.prototype;v.prototype=new s,v.prototype.constructor=v,v.prototype.add=function(a){var b=this.items.get(a._getId());return b||(b=this.createListItem(),b.setText(a.name),b.attachObject(a),this.bindButtons(b,a),this.list.add(b),this.items.put(a._getId(),b)),b},v.prototype.bindButtons=function(b,c){var d=this;b.editBtn.bind("click",function(c){var e=b.getAttachedObject();d.notifyListeners(a.events.Edit,e)}),b.removeBtn.bind("click",function(c){var e=b.getAttachedObject();a.depends.check(e)&&d.notifyListeners(a.events.Remove,e)})},v.prototype.clear=function(){this.list.clear(),this.items.clear()},v.prototype.createListItem=function(){return new a.ui.EditableListItem},v.prototype.layout=function(){w.layout.call(this),this.title=jQuery("<h1>"+this.config.title+"</h1>"),this.instructions=jQuery("<p>"+this.config.instructions+"</p>"),this.list=new a.ui.List({id:this.config.listId,prefix:this.config.prefix,type:this.config.type,sortable:this.config.sortable}),this.container.append(this.title).append(this.instructions).append(this.list.getUI())},v.prototype.remove=function(a){var b=this.items.get(a._getId()),c=!1;return b&&(b.removeObject(),this.list.remove(b),this.items.remove(a._getId()),c=!0),c},v.prototype.update=function(a){var b=this.items.get(a._getId()),c=!1;return b&&(b.setText(a.name),b.attachObject(a),c=!0),c};var y=null;a.ui.addNavPane=function(a,b){y.add(a,b)},a.ui.getNavBar=function(){return y},a.ui.getNavPane=function(b){var c=y.get(b);return c||(c=new a.ui.NavPane(b),c.setToolBar(new a.ui.ToolBar),y.add(c)),c},a.ui.initializeView=function(f){var g=jQuery("body");f.setBGColor(16777215,1);var h=new a.ui.GridPlane(f,b,c);y=new m;var i=f.camera;i.enableControl(),i.far=d,i.near=e;var j=new hemi.Viewpoint;j.eye=new THREE.Vector3(0,10,40),j.target=new THREE.Vector3(0,0,0),i.moveToView(j,0),jQuery(window).resize(x),x(),g.append('<div class="topBottomSelect"></div>')}}(editor),function(a){"use strict",a.ui=a.ui||{};var b=function(){a.ui.Component.call(this),this.progress=-1};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=jQuery('<div id="progressIndicator"></div>'),this.text=jQuery('<span class="prgBarText">Loading...</span>'),this.barWrapper=jQuery('<div class="prgBarContainer"></div>'),this.indicator=jQuery('<div class="prgBarIndicator"></div>'),this.barWrapper.append(this.indicator),this.container.append(this.text).append(this.barWrapper),this.container.css("zIndex",a.ui.Layer.DIALOG),this.update(0),hemi.subscribe(hemi.msg.progress,this,"msgUpdate")},b.prototype.msgUpdate=function(a){var b=a.data,c=this.progress;b.isTotal&&(c=b.percent,this.update(c))},b.prototype.setVisible=function(a){var b=this.container;if(a){var c=jQuery(window).height(),d=window.innerWidth?window.innerWidth:document.documentElement.offsetWidth,e=c-b.height(),f=(d-b.width())/2;b.show().css({top:e+20+"px",left:f+"px",opacity:0,position:"absolute"}).animate({opacity:1,top:"-=20"},300)}else b.animate({opacity:0,top:"+=20"},400,function(){b.hide()})},b.prototype.update=function(a){if(this.progress!==a){this.isVisible()||this.setVisible(!0);var b=this;this.progress=a,this.indicator.width(this.barWrapper.width()*a/100),this.progress>=99.9&&setTimeout(function(){b.progress=-1,b.setVisible(!1)},100)}},a.ui.progressUI=new b,jQuery(document).bind("ready",function(){jQuery("body").append(a.ui.progressUI.getUI()),a.ui.progressUI.container.hide()})}(editor),function(a){"use strict",a.ui=a.ui||{},a.ui.trans=a.ui.trans||{};var b=5,c=10,d=4;a.ui.trans.DrawState={TRANSLATE:0,ROTATE:1,SCALE:2,NONE:3};var e=a.ui.TransHandles=function(){a.utils.Listenable.call(this),this.canvas=hemi.hud.hudMgr.canvas,this.drawCallback=null,this.transform=null,this.xArrow=new f(this.canvas,"#f00","#f99"),this.yArrow=new f(this.canvas,"#0c0","#9c9"),this.zArrow=new f(this.canvas,"#00f","#99f"),this.drawState=a.ui.trans.DrawState.NONE,hemi.view.addRenderListener(this),this.overrideHandlers()};e.prototype=new a.utils.Listenable,e.prototype.constructor=e,e.prototype.cleanup=function(){this.setDrawState(a.ui.trans.DrawState.NONE),this.setTransform(null),hemi.view.removeRenderListener(this);var b=hemi.hud.hudMgr.downHandler,c=hemi.hud.hudMgr.upHandler,d=hemi.hud.hudMgr.moveHandler,e=this,f=hemi.hud.hudMgr.canvasElem;f.removeEventListener("mousedown",this.mouseDownHandler,!0),f.removeEventListener("mousemove",this.mouseMoveHandler,!0),f.removeEventListener("mouseup",this.mouseUpHandler,!0),f.addEventListener("mousedown",b,!0),f.addEventListener("mousemove",c,!0),f.addEventListener("mouseup",d,!0),jQuery(document).unbind("mouseup.transhandles")},e.prototype.drawHandles=function(){if(this.drawState!==a.ui.trans.DrawState.NONE){var b=this.transform.boundingBox.getCenterOfGeometry(),c=this.getExtent()/2,d=b[0],e=b[1],f=b[2],g=[d+c,e,f],h=[d,e+c,f],i=[d,e,f+c];this.xArrow.setParams(b,g,hemi.manip.Plane.XY,this.drawState,c),this.yArrow.setParams(b,h,hemi.manip.Plane.YZ,this.drawState,c),this.zArrow.setParams(b,i,hemi.manip.Plane.XZ,this.drawState,c)}},e.prototype.convertEvent=function(a){var b=jQuery(a.target?a.target:a.srcElement),c=b.offset();return a.x=a.pageX-c.left,a.y=a.pageY-c.top,a},e.prototype.getExtent=function(){var a=o3djs.util.getBoundingBoxOfTree(this.transform),b=hemi.utils.pointAsWorld(this.transform.parent,a.minExtent),c=hemi.utils.pointAsWorld(this.transform.parent,a.maxExtent),e=Math.abs(b[0]-c[0]),f=Math.abs(b[1]-c[1]),g=Math.abs(b[2]-c[2]),h=(e+f+g)/3;return h<d?d:h},e.prototype.isInView=function(){var a=[[],[],[],[]],b=this.transform,c=this.transform.boundingBox;o3d.Transform.compose(hemi.view.viewInfo.drawContext.view,b.getUpdatedWorldMatrix(),a),o3d.Transform.compose(hemi.view.viewInfo.drawContext.projection,a,a);var d=b.boundingBox.inFrustum(a);return d},e.prototype.onChange=function(b){var c=this;this.notifyListeners(a.events.Updated,{tran:c.transform,delta:b})},e.prototype.onMouseDown=function(b){if(!this.transform||this.drawState===a.ui.trans.DrawState.NONE)return!1;var c=b.x,d=b.y,e,f,g;this.xArrow.isInside(c,d)?(this.down=!0,e=hemi.manip.Plane.XY,f=hemi.manip.Axis.Z,g=hemi.manip.Axis.X):this.yArrow.isInside(c,d)?(this.down=!0,e=hemi.manip.Plane.YZ,f=hemi.manip.Axis.X,g=hemi.manip.Axis.Y):this.zArrow.isInside(c,d)&&(this.down=!0,e=hemi.manip.Plane.XZ,f=hemi.manip.Axis.Y,g=hemi.manip.Axis.Z);if(this.down){switch(this.drawState){case a.ui.trans.DrawState.ROTATE:this.startRotate(f,b);break;case a.ui.trans.DrawState.SCALE:this.startScale(g,b);break;case a.ui.trans.DrawState.TRANSLATE:this.startTranslate(e,b)}return!0}return!1},e.prototype.onMouseMove=function(b){if(!this.transform||this.down||this.drawState===a.ui.trans.DrawState.NONE)return!1;var c=b.x,d=b.y,e=!1;return this.xArrow.hover=!1,this.yArrow.hover=!1,this.zArrow.hover=!1,this.xArrow.isInside(c,d)?e=this.xArrow.hover=!0:this.yArrow.isInside(c,d)?e=this.yArrow.hover=!0:this.zArrow.isInside(c,d)&&(e=this.zArrow.hover=!0),e},e.prototype.onMouseUp=function(a){if(!this.down)return!1;this.down=!1,this.dragger&&(this.dragger.cleanup(),this.dragger=null),this.turnable&&(this.turnable.cleanup(),this.turnable=null),this.scalable&&(this.scalable.cleanup(),this.scalable=null),hemi.world.camera.enableControl();var b=this.transform.getParam("ownerId");return b&&(owner=hemi.world.getCitizenById(b.value),owner.setTransformMatrix?owner.setTransformMatrix(this.transform,this.transform.localMatrix):owner.setMatrix&&owner.setMatrix(this.transform.localMatrix)),!0},e.prototype.onRender=function(a){this.transform&&(hemi.hud.hudMgr.clearDisplay(),this.drawCallback&&this.drawCallback(),this.drawHandles())},e.prototype.overrideHandlers=function(){var a=hemi.hud.hudMgr.downHandler,b=hemi.hud.hudMgr.upHandler,c=hemi.hud.hudMgr.moveHandler,d=this,e=hemi.hud.hudMgr.canvasElem;e.removeEventListener("mousedown",a,!0),e.removeEventListener("mousemove",c,!0),e.removeEventListener("mouseup",b,!0),this.mouseDownHandler=function(b){var c=hemi.utils.clone(b,!1);d.convertEvent(c),d.onMouseDown(c)||a(b)},this.mouseUpHandler=function(a){var c=hemi.utils.clone(a,!1);d.convertEvent(c),d.onMouseUp(c)||b(a)},this.mouseMoveHandler=function(a){var b=hemi.utils.clone(a,!1);d.convertEvent(b),d.onMouseMove(b)||c(a)},e.addEventListener("mousedown",this.mouseDownHandler,!0),e.addEventListener("mousemove",this.mouseMoveHandler,!0),e.addEventListener("mouseup",this.mouseUpHandler,!0),jQuery(document).bind("mouseup.transhandles",function(a){d.onMouseUp(a)})},e.prototype.setDrawCallback=function(a){this.drawCallback=a},e.prototype.setDrawState=function(a){this.drawState=a,this.onRender()},e.prototype.setTransform=function(b){b&&hemi.utils.isAnimated(b)?(this.transform=null,this.drawState!==a.ui.trans.DrawState.NONE&&hemi.hud.hudMgr.clearDisplay()):this.transform=b,this.onRender()},e.prototype.startRotate=function(a,b){hemi.world.camera.disableControl(),this.turnable=new hemi.manip.Turnable(a),this.turnable.addTransform(this.transform),this.turnable.enable(),this.turnable.onPick({shapeInfo:{parent:{transform:this.transform}}},b)},e.prototype.startScale=function(a,b){hemi.world.camera.disableControl(),this.scalable=new hemi.manip.Scalable(a),this.scalable.addTransform(this.transform),this.scalable.subscribe(hemi.msg.scale,this,"onChange",[hemi.dispatch.MSG_ARG+"data.scale"]),b.shiftKey&&(this.scalable.axis=[1,1,1]),this.scalable.enable(),this.scalable.onPick({shapeInfo:{parent:{transform:this.transform}}},b)},e.prototype.startTranslate=function(b,c){hemi.world.camera.disableControl(),this.dragger=new hemi.manip.Draggable,this.dragger.name=a.ToolConstants.EDITOR_PREFIX+"Dragger",this.dragger.setPlane(b),this.dragger.subscribe(hemi.msg.drag,this,"onChange",[hemi.dispatch.MSG_ARG+"data.drag"]);switch(b){case hemi.manip.Plane.XY:this.dragger.vmin=this.dragger.vmax=0;break;case hemi.manip.Plane.YZ:this.dragger.umin=this.dragger.umax=0;break;case hemi.manip.Plane.XZ:this.dragger.umin=this.dragger.umax=0}this.dragger.addTransform(this.transform),this.dragger.onPick({shapeInfo:{parent:{transform:this.transform}}},c)};var f=function(a,b,c){this.canvas=a,this.clr=b,this.hvrClr=c,this.math=hemi.core.math};f.prototype.isInside=function(a,b){return a>=this.topLeft[0]&&a<=this.bottomRight[0]&&b>=this.topLeft[1]&&b<=this.bottomRight[1]},f.prototype.drawLine=function(){var a=this.canvas,b=this.config;a.beginPath(),a.moveTo(b.orgPnt[0],b.orgPnt[1]),a.lineTo(b.endPnt[0],b.endPnt[1]),a.strokeStyle=this.hover?this.hvrClr:this.clr,a.lineWidth=b.lineWidth,a.stroke()},f.prototype.drawRotater=function(){var a=this.config,b=a.origin,c=a.vector,d=Math.PI/90,e=Math.PI/2,f=a.extent,g=[e-d*3,e-d*2,e-d,e,e+d,e+d*2,e+d*3],h=this.canvas,i,j;h.beginPath();for(var k=0,l=g.length;k<l;k++){var m=g[k],n=hemi.core.math.copyVector(b);switch(a.plane){case hemi.manip.Plane.XY:n[1]=b[1]+f*Math.cos(m),n[0]=b[0]+f*Math.sin(m);break;case hemi.manip.Plane.YZ:n[2]=b[2]+f*Math.cos(m),n[1]=b[1]+f*Math.sin(m);break;case hemi.manip.Plane.XZ:n[0]=b[0]+f*Math.cos(m),n[2]=b[2]+f*Math.sin(m)}n=hemi.utils.worldToScreen(n),k===0?(h.moveTo(n[0],n[1]),i=n):k===l-1&&(j=n),h.lineTo(n[0],n[1])}h.strokeStyle=this.hover?this.hvrClr:this.clr,h.lineWidth=a.lineWidth*3,h.lineCap="round",h.stroke();var o=i[0],p=j[0],q=i[1],r=j[1],s=Math.min(o,p),t=Math.min(q,r),u=Math.max(o,p),v=Math.max(q,r);Math.abs(o-p)<5&&(u=s+5),Math.abs(q-r)<5&&(v=t+5),this.topLeft=[s,t],this.bottomRight=[u,v]},f.prototype.drawScaler=function(){var a=this.config,b=a.origin,c=a.vector,d=a.extent/8,e=[],f=this.canvas,g=this.hover?this.hvrClr:this.clr,h=function(a,b,e){var f=hemi.core.math.copyVector(c),g=[];f[a]=c[a]+d/2,f[b]=c[b]+d/2,g.push(f);var h=hemi.core.math.copyVector(f);h[b]-=d,g.push(h);var i=hemi.core.math.copyVector(h);i[a]-=d,g.push(i);var j=hemi.core.math.copyVector(i);j[b]+=d,g.push(j);var k=hemi.core.math.copyVector(j);return k[e]+=d,g.push(k),k=hemi.core.math.copyVector(i),k[e]+=d,g.push(k),k=hemi.core.math.copyVector(h),k[e]+=d,g.push(k),k=hemi.core.math.copyVector(f),k[e]+=d,g.push(k),g},i=function(a,b,c,d){f.beginPath(),f.moveTo(a[0],a[1]),f.lineTo(b[0],b[1]),f.lineTo(c[0],c[1]),f.lineTo(d[0],d[1]),f.lineTo(a[0],a[1]),f.closePath(),f.fillStyle=g,f.fill()};switch(a.plane){case hemi.manip.Plane.XY:e=h(1,2,0);break;case hemi.manip.Plane.YZ:e=h(2,0,1);break;case hemi.manip.Plane.XZ:e=h(0,1,2)}var j,k,l,m;j=k=1e7,l=m=-1e7;for(var n=0,o=e.length;n<o;n++){var p=hemi.utils.worldToScreen(e[n]);j=Math.min(j,p[0]),k=Math.min(k,p[1]),l=Math.max(l,p[0]),m=Math.max(m,p[1])}var q=hemi.utils.worldToScreen(e[0]),r=hemi.utils.worldToScreen(e[1]),s=hemi.utils.worldToScreen(e[2]),t=hemi.utils.worldToScreen(e[3]),u=hemi.utils.worldToScreen(e[4]),v=hemi.utils.worldToScreen(e[5]),w=hemi.utils.worldToScreen(e[6]),x=hemi.utils.worldToScreen(e[7]);i(q,r,s,t),i(q,x,u,t),i(q,r,w,x),i(x,w,v,u),i(w,v,t,s),i(t,s,v,u),this.topLeft=[j,k],this.bottomRight=[l,m]},f.prototype.drawTranslator=function(){var a=this.config,b=a.origin,c=a.vector,d=Math.PI/90,e=Math.PI/2,f=a.extent/10,g=hemi.core.math.copyVector(c),h=180,i=0,j=[],k=a.extent/5,l=this.canvas,m=this.hover?this.hvrClr:this.clr,n=0,o=0,p=function(a){var b=0,c={pnt1:a[0],pnt2:a[0]};for(var d=0,e=a.length;d<e;d++){var f=a[d];for(var g=d+1;g<e;g++){var h=a[g],i=hemi.core.math.distance(f,h);i>b&&(b=i,c.pnt1=f,c.pnt2=h)}}return c};switch(a.plane){case hemi.manip.Plane.XY:g[0]=c[0]+k,n=1,o=2;break;case hemi.manip.Plane.YZ:g[1]=c[1]+k,n=2;break;case hemi.manip.Plane.XZ:g[2]=c[2]+k,n=1}g=hemi.utils.worldToScreen(g),l.beginPath();for(var q=0;q<h;q++){var r=hemi.core.math.copyVector(c);i=i+=d,r[n]=c[n]+f*Math.cos(i),r[o]=c[o]+f*Math.sin(i),r=hemi.utils.worldToScreen(r),q===0&&l.moveTo(r[0],r[1]),l.lineTo(r[0],r[1]);var s=r[0],t=r[1];j.push(r)}l.closePath(),l.fillStyle=m,l.fill();var u=p(j),v=u.pnt1,w=u.pnt2,x=Math.max(v[0],w[0],g[0]),y=Math.max(v[1],w[1],g[1]),z=Math.min(v[0],w[0],g[0]),A=Math.min(v[1],w[1],g[1]);l.beginPath(),l.moveTo(v[0],v[1]),l.lineTo(w[0],w[1]),l.lineTo(g[0],g[1]),l.closePath(),l.fillStyle=m,l.fill(),this.topLeft=[z,A],this.bottomRight=[x,y]},f.prototype.setParams=function(b,c,d,e,f){var g=hemi.utils.worldToScreen(c),h=hemi.utils.worldToScreen(b),i=this.math.distance(h,g),j=hemi.world.camera.getEye(),k=this.math.normalize(this.math.subVector(j,b)),l=this.math.normalize(this.math.subVector(c,b));if(!isNaN(k[0])&&!isNaN(l[0])){this.config={origin:b,vector:c,orgPnt:h,endPnt:g,distance:i,centerEye:k,centerArrow:l,plane:d,extent:f,lineWidth:3},this.drawLine();switch(e){case a.ui.trans.DrawState.TRANSLATE:this.drawTranslator();break;case a.ui.trans.DrawState.ROTATE:this.drawRotater();break;case a.ui.trans.DrawState.SCALE:this.drawScaler()}}}}(editor),function(a){a.ui=a.ui||{},a.ui.GridPlane=function(a,b,c){this.extent=b,this.fidelity=c,this.client=a,this.createShape()},a.ui.GridPlane.prototype.createShape=function(){var a=new THREE.MeshPhongMaterial({color:6710886,opacity:.2,wireframe:!0}),b=new THREE.MeshPhongMaterial({color:6710886,lighting:!1,opacity:.5,wireframe:!0}),c=this.extent/this.fidelity,d=this.extent*2,e=this.fidelity*5,f=this.extent/e,g=new THREE.Mesh(new THREE.PlaneGeometry(d,d,c,c),a),h=new THREE.Mesh(new THREE.PlaneGeometry(d,d,f,f),b);coloredPlane=new THREE.Mesh(new THREE.PlaneGeometry(d,d),new THREE.MeshBasicMaterial({color:7721204,opacity:.1})),this.transform=new THREE.Object3D,this.transform.add(g),this.transform.add(h),this.transform.add(coloredPlane),coloredPlane.translateZ(-0.1),this.transform.rotation.x=-Math.PI/2,this.material=a,this.markerMaterial=b,this.client.scene.add(this.transform)},a.ui.GridPlane.prototype.setVisible=function(a){this.transform.visible=a}}(editor),function(a){"use strict",a.ui=a.ui||{};var b=function(a,b){var c=jQuery('<div title="'+b+'" id="'+a+'Dlg" class="simpleDialog">\t\t\t\t<p></p>\t\t\t\t<form method="post" action="">\t\t\t\t\t<label></label>\t\t\t\t</form>\t\t\t</div>'),d=c.find("form").submit(function(){return!1}),e=c.find("p").hide(),f=c.find("label");return c.data("msg",e).data("label",f).data("form",d),c};a.ui.createDependencyDialog=function(a){var c=b("showDeps","Unable to Remove"),d=c.data("form").attr("style","float:none;"),e=c.data("msg").attr("style","text-align:left;"),f=jQuery('<p style="text-align:left;" id="depList"></p>'),g=jQuery('<button id="okayBtn">Okay</button>');return d.append(f),c.append(g),e.text("The following elements depend on this element either directly\t\t\t\tor indirectly. Please remove or modify them first."),f.html(a),g.click(function(){c.dialog("close")}),c.dialog({width:300,resizable:!1,autoOpen:!1,modal:!0}).bind("dialogopen",function(){d.show(),e.show()}),c}}(editor),function(a){function e(){var a=!1;for(var b=0,c=this.tools.length;b<c&&!a;b++)a|=this.tools[b].enabled;return a}function f(b){var c=!1;for(var d=0,f=this.tools.length;d<f&&!c;d++){var h=this.tools[d];h.tool===b.item&&(h.enabled=b.enabled,c=!0)}if(!b.enabled){b.item.setMode(a.ToolConstants.MODE_UP);if(!e.call(this))this.notifyListeners(a.events.Enabled,{item:this,enabled:!1});else if(!this.hidden){var i=g.call(this);this.hidden||i.setMode(a.ToolConstants.MODE_DOWN),this.header.text(i.toolTitle)}}else!this.hidden&&this.getActiveTool()==null&&b.item.setMode(a.ToolConstants.MODE_DOWN),this.notifyListeners(a.events.Enabled,{item:this,enabled:!0})}function g(){var a=null;for(var b=0,c=this.tools.length;b<c&&a==null;b++){var d=this.tools[b];d.enabled&&(a=d.tool)}return a}function h(a,b){var c=null,d=b.indexOf(a);if(d!=-1){var e=b.splice(d,1);e.length==1&&(c=e[0])}return c}function l(a){var b=jQuery("<li></li>");return b.append(a.getUI()).data("component",a),b}"use strict",a.ui=a.ui||{},a.tools=a.tools||{},a.ToolConstants={EDITOR_PREFIX:"EditorCitizen:",MODE_DOWN:"down",MODE_UP:"up"};var b=new Hashtable,c=new Hashtable;a.getModel=function(a){return b.get(a)},a.getModels=function(){return b.values()},a.getView=function(a){return c.get(a)},a.getViews=function(){return c.values()};var d=a.ui.ToolBar=function(b){this.tools=[],this.savedTool=null,this.mousedIn=[],this.hidden=!0,a.ui.Component.call(this)};d.prototype=new a.ui.Component,d.prototype.constructor=d,d.prototype.add=function(b){b instanceof a.ToolView&&(this.tools.push({tool:b,enabled:!0}),this.list.append(l(b)),b.addListener(a.events.ToolClicked,this),b.addListener(a.events.ToolMouseIn,this),b.addListener(a.events.ToolMouseOut,this),b.addListener(a.events.Enabled,this))},d.prototype.layout=function(){this.container=jQuery('<div class="toolbar"></div>'),this.header=jQuery('<h3 class="toolTitle"></h3>'),this.list=jQuery("<ul></ul>"),this.container.append(this.header).append(this.list)},d.prototype.getActiveTool=function(){for(var b=0,c=this.tools.length;b<c;b++){var d=this.tools[b].tool;if(d.mode===a.ToolConstants.MODE_DOWN)return d}return null},d.prototype.loadState=function(){var b=this.savedTool;b==null&&(b=this.tools[0].tool),b.setMode(a.ToolConstants.MODE_DOWN),this.header.text(b.toolTitle),this.hidden=!1},d.prototype.notify=function(b,c){switch(b){case a.events.ToolClicked:var d=this.tools;for(ndx=0,len=d.length;ndx<len;ndx++){var e=d[ndx].tool;e!=c&&e.setMode(a.ToolConstants.MODE_UP)}this.header.text(c.toolTitle);break;case a.events.ToolMouseIn:this.header.css("opacity",0),this.mousedIn.push(c);break;case a.events.ToolMouseOut:h(c,this.mousedIn),this.mousedIn.length===0&&this.header.css("opacity",1);break;case a.events.Enabled:f.call(this,c)}},d.prototype.remove=function(a){var a=h(a,this.tools);a.getUI().remove()},d.prototype.saveState=function(){this.savedTool=this.getActiveTool(),this.savedTool&&this.savedTool.setMode(a.ToolConstants.MODE_UP),this.hidden=!0},d.prototype.setEnabled=function(a){for(var b=0,c=this.tools.length;b<c;b++)this.tools[b].setEnabled(a)};var i=a.ToolModel=function(c){a.utils.Listenable.call(this),this.id=c,c&&(b.put(c,this),a.notifyListeners(a.events.ModelAdded,{id:c,model:this}),a.addListener(a.events.WorldCleaned,this),a.addListener(a.events.WorldLoaded,this))};i.prototype=new a.utils.Listenable,i.prototype.constructor=i,i.prototype.getId=function(){return this.id},i.prototype.notify=function(b,c){switch(b){case a.events.WorldCleaned:this.worldCleaned();break;case a.events.WorldLoaded:this.worldLoaded()}},i.prototype.worldCleaned=function(){},i.prototype.worldLoaded=function(){},a.ToolViewDefaults={id:"",toolName:"toolName",toolTip:""};var j=a.ToolView=function(b){a.utils.Listenable.call(this),this.config=jQuery.extend({},a.ToolViewDefaults,b),this.toolTitle=this.config.toolName,this.toolbarContainer=null,this.enabled=!0,this.mode=a.ToolConstants.MODE_UP,this.panels=[],this.visiblePanels=[],this.id=this.config.id,this.id&&(this.layoutToolBarContainer(),c.put(this.id,this),a.notifyListeners(a.events.ViewAdded,{id:this.id,view:this}))};j.prototype=new a.utils.Listenable,j.prototype.constructor=j,j.prototype.setEnabled=function(b){this.enabled!=b&&(this.enabled=b,b?this.toolbarContainer.show():this.toolbarContainer.hide(),this.notifyListeners(a.events.Enabled,{item:this,enabled:b}))},j.prototype.setMode=function(b){var c=this.mode;this.mode=b,this.toolbarContainer&&(this.toolbarContainer.removeClass(c),this.toolbarContainer.addClass(this.mode));switch(b){case a.ToolConstants.MODE_DOWN:for(var d=0,e=this.visiblePanels.length;d<e;d++)this.visiblePanels[d].setVisible(!0);this.visiblePanels=[];break;case a.ToolConstants.MODE_UP:for(var d=0,e=this.panels.length;d<e;d++){var f=this.panels[d];f.isVisible()&&(this.visiblePanels.push(f),f.setVisible(!1))}}this.notifyListeners(a.events.ToolModeSet,{oldMode:c,newMode:b})},j.prototype.getUI=function(){return this.toolbarContainer},j.prototype.layoutToolBarContainer=function(){var b=this,c=["toolBtn",this.id,this.mode];this.toolbarContainer=jQuery('<div class="'+c.join(" ")+'" title="'+this.config.toolTip+'"></div>'),this.toolHover=jQuery('<h3 class="toolHover">'+this.config.toolName+"</h3>").css("zIndex",a.ui.Layer.TOOLBAR),this.toolbarContainer.append(this.toolHover),this.toolbarContainer.bind("click",function(){b.mode!==a.ToolConstants.MODE_DOWN&&(b.notifyListeners(a.events.ToolClicked,b),b.setMode(a.ToolConstants.MODE_DOWN))}).bind("mouseover",function(c){b.mode===a.ToolConstants.MODE_UP&&(b.toolHover.fadeIn(100),b.notifyListeners(a.events.ToolMouseIn,b))}).bind("mouseout",function(c){b.toolHover.promise("fx").done(function(){b.toolHover.fadeOut(100),b.notifyListeners(a.events.ToolMouseOut,b)})})},j.prototype.addPanel=function(a){jQuery.inArray(a,this.panels)===-1&&(this[a.getName()]=a,this.panels.push(a),a.config.startsVisible&&this.visiblePanels.push(a))},j.prototype.removePanel=function(a){var b=this.panels.indexOf(a);b!=-1&&(this.panels.splice(b,1),delete this[a.getName()])};var k=a.ToolController=function(){this.model,this.view};k.prototype.setView=function(a){this.view=a,this.checkBindEvents()&&this.bindEvents()},k.prototype.setModel=function(a){this.model=a,this.checkBindEvents()&&this.bindEvents()},k.prototype.checkBindEvents=function(){return this.model&&this.view},k.prototype.bindEvents=function(){}}(editor),function(a){"use strict";var b=a.projects={},c=null;b.init=function(){var f=new a.ui.NavPane("Project:"),g=new a.ui.ToolBar,h=new m,i=new n;c=new e,i.setModel(c),i.setView(h),g.add(h),f.setToolBar(g),a.ui.addNavPane(f,"prjPane");var j=f.getUI();j.find("a").unbind("click").bind("click",function(){var a=h.buttons.is(":visible");a?h.cancel():(h.notifyListeners(b.events.UpdateProjects),h.showButtons())}),f.setVisible(!0),h.sidePanel.addListener(a.events.PanelVisible,function(b){var c=a.ui.getNavBar().visiblePane;c&&!h.isPreview&&c.setVisible(!b.visible)});var k=a.getModels();for(var l=0,o=k.length;l<o;++l){var p=k[l];p!==c&&(p.addListener(a.events.Created,c),p.addListener(a.events.Removing,c),p.addListener(a.events.Updated,c))}a.addListener(a.events.PluginLoaded,function(b){var d=a.getModel(b);d&&(d.addListener(a.events.Created,c),d.addListener(a.events.Removing,c),d.addListener(a.events.Updated,c))});var q=setInterval(function(){c.dirty&&!c.loading&&(c.save(d,!0),c.dirty=!1)},5e3);jQuery(document).unload(function(){clearInterval(q)})},b.events={CheckProjectExists:"checkProjectExists",Load:"load",Loaded:"loaded",NewProject:"newProject",Projects:"projects",ProjectExists:"projectExsits",Publish:"publish",Published:"published",Save:"save",Saved:"saved",ServerRunning:"serverRunning",StartPreview:"startPreview",StopPreview:"stopPreview",UpdateProjects:"updateProjects"};var d="_AutoSave_",e=function(){a.ToolModel.call("projectLoad");var c=this;this.projectCache=[],this.serverRunning=!0,this.dirty=!1,this.loading=!1,this.current=null,jQuery.ajax({url:"/projects",dataType:"json",success:function(a,b,d){c.projectCache=a.projects},error:function(a,d,e){c.serverRunning=!1,c.notifyListeners(b.events.ServerRunning,!1)}})},f=a.ToolModel.prototype;e.prototype=new a.ToolModel,e.prototype.constructor=e,e.prototype.checkExisting=function(a){this.notifyListeners(b.events.ProjectExists,{exists:g.call(this,a)!==-1,project:a})},e.prototype.getProjects=function(){this.notifyListeners(b.events.Projects,this.serverRunning?this.projectCache:null)},e.prototype.load=function(c){var d={name:c},e=a.getDispatchProxy(),f=this;jQuery.ajax({url:"/project",data:d,dataType:"json",success:function(a,d,g){f.loading=!0,hemi.world.send(hemi.msg.cleanup),e.swap(),hemi.octane.createWorld(a),e.unswap(),hemi.world.ready(),f.notifyListeners(b.events.Loaded,{project:c,succeeded:!0})},error:function(a,d,e){f.notifyListeners(b.events.Loaded,{project:c,succeeded:!1})}})},e.prototype.newProject=function(){hemi.world.cleanup(),hemi.world.camera.enableControl(),hemi.world.ready();var a=hemi.view.createViewData(hemi.world.camera);a.eye=[0,10,40],a.target=[0,0,0],hemi.world.camera.moveToView(a,0),this.notifyListeners(b.events.NewProject)},e.prototype.notify=function(b,c){f.notify.call(b,c);switch(b){case a.events.Created:case a.events.Removing:case a.events.Updated:this.dirty=!0}},e.prototype.publish=function(a){this.save(a,!0);var c={name:a},d=hemi.world.getModels(),e=this;if(d.length>0){var f=[];for(var h=0,i=d.length;h<i;h++)f.push(d[h].name);c.models=f.join(", ")}else c.models="No models needed!";jQuery.ajax({url:"/publish",data:c,dataType:"json",type:"post",success:function(c,d,f){var h=g.call(e,a);e.projectCache[h].published=!0,e.notifyListeners(b.events.Published,{name:a,published:!0})},error:function(c,d,f){e.notifyListeners(b.events.Published,{name:a,published:!1})}})},e.prototype.remove=function(b){var c={name:b},d=this;jQuery.ajax({url:"/project",data:c,dataType:"json",type:"delete",success:function(c,e,f){d.notifyListeners(a.events.Removing,c.name);var h=g.call(d,b);h!==-1&&d.projectCache.splice(h,1)},error:function(a,b,c){d.serverRunning=!1}})},e.prototype.save=function(c,d){d=d||!1;var e={name:c,octane:JSON.stringify(a.getProjectOctane()),replace:d},f=this;jQuery.ajax({url:"/project",data:e,dataType:"json",type:"post",success:function(a,d,e){f.notifyListeners(b.events.Saved,{project:c,saved:!0}),f.projectCache.push({name:c,published:!1})},error:function(a,d,e){f.serverRunning=!1,f.notifyListeners(b.events.Saved,{project:c,saved:!1})}})},e.prototype.startPreview=function(){if(this.worldState!=null)return;var b=hemi.input,c=hemi.core.client.root,d=hemi.world,e=a.getProjectOctane();e=hemi.utils.clone(e),this.worldState={camera:d.camera,citizens:d.citizens,loader:d.loader,pickGrabber:d.pickGrabber,tranReg:d.tranReg,fog:d.fog,nextId:d.checkNextId(),msgSpecs:hemi.dispatch.msgSpecs,pickRoot:hemi.picking.pickRoot,pickManager:hemi.picking.pickManager,modelRoot:hemi.model.modelRoot,shapeRoot:hemi.shape.root,children:c.children,rL:hemi.view.renderListeners,mdL:b.mouseDownListeners,muL:b.mouseUpListeners,mmL:b.mouseMoveListeners,mwL:b.mouseWheelListeners,kdL:b.keyDownListeners,kuL:b.keyUpListeners,kpL:b.keyPressListeners};var f=c.children;c.children=[];for(var g=0;g<f.length;g++)f[g].parent=null;hemi.view.renderListeners=[hemi.view.clientSize],b.mouseDownListeners=[d],b.mouseUpListeners=[],b.mouseMoveListeners=[],b.mouseWheelListeners=[],b.keyDownListeners=[],b.keyUpListeners=[],b.keyPressListeners=[],d.citizens=new hemi.utils.Hashtable,d.camera=null,d.loader={finish:function(){}},d.pickGrabber=null,d.tranReg=new hemi.world.TransformRegistry,d.fog=null,hemi.dispatch.msgSpecs=new hemi.utils.Hashtable,hemi.picking.init(),hemi.model.init(),hemi.shape.root=hemi.core.mainPack.createObject("Transform"),hemi.shape.root.name=hemi.shape.SHAPE_ROOT,hemi.shape.root.parent=hemi.picking.pickRoot,hemi.world.subscribe(hemi.msg.progress,a.ui.progressUI,"msgUpdate"),hemi.octane.createWorld(e),hemi.world.ready()},e.prototype.stopPreview=function(){if(this.worldState==null)return;var a=hemi.input,b=hemi.core.client.root,c=hemi.world,d=this.worldState;c.cleanup(),hemi.dispatch.cleanup(),c.camera.cleanup(),hemi.hud.hudMgr.clearDisplay(),hemi.model.modelRoot.parent=null,hemi.core.mainPack.removeObject(hemi.model.modelRoot),hemi.shape.root.parent=null,hemi.core.mainPack.removeObject(hemi.shape.root),hemi.picking.pickRoot.parent=null,hemi.core.mainPack.removeObject(hemi.picking.pickRoot),hemi.dispatch.msgSpecs=d.msgSpecs,hemi.picking.pickRoot=d.pickRoot,hemi.picking.pickManager=d.pickManager,hemi.model.modelRoot=d.modelRoot,hemi.shape.root=d.shapeRoot,hemi.shape.material.getParam("lightWorldPos").bind(d.camera.light.position),hemi.shape.transMaterial.getParam("lightWorldPos").bind(d.camera.light.position),d.fog!=null&&(c.fog=d.fog,hemi.view.setBGColor(d.fog.color)),c.tranReg=d.tranReg,c.pickGrabber=d.pickGrabber,c.loader=d.loader,c.camera=d.camera,c.citizens=d.citizens,c.setNextId(d.nextId),a.mouseDownListeners=d.mdL,a.mouseUpListeners=d.muL,a.mouseMoveListeners=d.mmL,a.mouseWheelListeners=d.mwL,a.keyDownListeners=d.kdL,a.keyUpListeners=d.kuL,a.keyPressListeners=d.kpL,hemi.view.renderListeners=d.rL,b.children=d.children;for(var e=0;e<d.children.length;e++)d.children[e].parent=b;c.camera.update(),c.camera.updateProjection(),this.worldState=null};var g=function(a){var b=-1,c=a.toLowerCase();for(var d=0,e=this.projectCache.length;d<e&&b===-1;d++)this.projectCache[d].name.toLowerCase()===c&&(b=d);return b},h=function(){a.ui.EditableListItem.call(this,{editable:!1}),this.versionsHash=new Hashtable},i=a.ui.EditableListItem.prototype;h.prototype=new a.ui.EditableListItem,h.prototype.constructor=h,h.prototype.add=function(b,c){var d=new a.ui.EditableListItem({editable:!1,removeable:!1});d.setText(c),d.attachObject(c),this.bindButtons(d),this.list.add(d),this.versionsHash.put(c,d)},h.prototype.layout=function(){i.layout.call(this);var c=jQuery("<h2>Versions:</h2>"),d=jQuery('<div class="prjListWrapper"></div>'),e=jQuery('<div class="prjListArrow"></div>'),f=this;this.list=new a.ui.List({cssClass:"prjLst",prefix:"prjLst"}),this.publishLink=jQuery('<a class="publish" href="" target="_blank">View Published</a>'),d.append(c).append(this.list.getUI()).hide(),e.hide(),this.container.append(e).append(d),this.removeBtn.before(this.publishLink.hide()),this.title.bind("click",function(){f.notifyListeners(b.events.Load,f.getText())})},h.prototype.remove=function(a){var b=this.versionsHash.remove(a);this.list.remove(b)};var j=function(b){a.ui.ListWidget.call(this,{name:"prjListWidget",listId:"projectList",prefix:"prjLst",title:"Projects",instructions:"Click on a project to load it. Click the 'x' to delete.",height:a.ui.Height.FULL}),this.container.addClass("widgetWithForms")};j.prototype=new a.ui.ListWidget,j.prototype.constructor=e,j.prototype.add=function(a){var b=this.items.get(a.name);return b||(b=this.createListItem(),b.setText(a.name),this.bindButtons(b,a),this.list.add(b),this.items.put(a.name,b)),b},j.prototype.bindButtons=function(b,c){var d=this;c.published&&b.publishLink.attr("href","/projects/"+c.name+".html").show(),b.removeBtn.bind("click",function(b){d.notifyListeners(a.events.Remove,c.name)})},j.prototype.createListItem=function(){var a=new h,c=this;return a.addListener(b.events.Load,function(a){c.notifyListeners(b.events.Load,a)}),a},j.prototype.remove=function(a){var b=this.items.get(a),c=!1;return b&&(this.list.remove(b),this.items.remove(a),c=!0),c},j.prototype.update=function(a){var b=this.items.get(a.name),c=!1;return b&&(a.published&&b.publishLink.attr("href","/projects/"+a.name+".html").show(),c=!0),c};var k=function(){a.ui.Widget.call(this,{name:"previewWidget",classes:["previewWidget"],height:a.ui.Height.MANUAL})},l=a.ui.Widget.prototype;k.prototype=new a.ui.Widget,k.prototype.constructor=k,k.prototype.layout=function(){l.layout.call(this);var a=this,c=jQuery("<h1>World<span>Editor</span></h1>"),d=jQuery("<h2>Preview Mode</h2>"),e=jQuery("<div></div>");this.stopBtn=jQuery('<button id="prjStopPreviewBtn">Stop Preview</button>'),this.stopBtn.bind("click",function(){a.notifyListeners(b.events.StopPreview)}),e.append(c).append(d),this.container.append(e).append(this.stopBtn)};var m=function(){a.ToolView.call(this,{toolName:"Project:",toolTip:"",id:"projectLoad"}),this.addPanel(new a.ui.Panel({classes:["prjSidePanel"],startsVisible:!1})),this.addPanel(new a.ui.Panel({location:a.ui.Location.TOP,classes:["prjTopPanel"],startsVisible:!1})),this.sidePanel.addWidget(new j),this.topPanel.addWidget(new k)};m.prototype=new a.ToolView,m.prototype.constructor=m,m.prototype.cancel=function(){this.hideButtons(),this.sidePanel.setVisible(!1),this.saveIpt.val("").show().blur(),jQuery(document).unbind("click.prj")},m.prototype.checkSaveable=function(){var a=this.saveIpt.val(),b=a!=="Unsaved Project"&&a!=="";return b?(this.saveBtn.removeAttr("disabled"),this.publishBtn.removeAttr("disabled")):(this.saveBtn.attr("disabled","disabled"),this.publishBtn.attr("disabled","disabled")),b},m.prototype.hideButtons=function(){this.buttons.slideUp(200)},m.prototype.layoutToolBarContainer=function(){var c=this.toolbarContainer=jQuery('<div id="'+this.id+'"> \t\t\t\t<p id="prjMsg"></p> \t\t\t\t<input type="text" id="prjSaveIpt" value="Unsaved Project" /> \t\t\t\t<div class="buttons"> \t\t\t\t\t<button id="prjSaveBtn">Save</button> \t\t\t\t\t<button id="prjCancelBtn">Cancel</button> \t\t\t\t\t<button id="prjPreviewBtn">Preview</button> \t\t\t\t\t<button id="prjPublishBtn">Publish</button> \t\t\t\t\t<button id="prjNewBtn">New Project</button> \t\t\t\t</div> \t\t\t</div>'),d=this,e=this.saveIpt=c.find("#prjSaveIpt"),f=this.saveBtn=c.find("#prjSaveBtn"),g=this.cancelBtn=c.find("#prjCancelBtn").hide(),h=this.newBtn=c.find("#prjNewBtn"),i=this.previewBtn=c.find("#prjPreviewBtn"),j=this.publishBtn=c.find("#prjPublishBtn");this.buttons=c.find("div.buttons").hide(),this.msg=c.find("#prjMsg").hide(),g.bind("click",function(){d.cancel()}),h.bind("click",function(){d.notifyListeners(b.events.NewProject)}),i.bind("click",function(c){d.isPreview=!0,d.notifyListeners(b.events.StartPreview),a.ui.getNavBar().setVisible(!1),d.sidePanel.setVisible(!1),d.topPanel.setVisible(!0)}),j.bind("click",function(){d.notifyListeners(b.events.Publish,e.val())}),f.bind("click",function(a){f.hasClass("overwrite")?d.notifyListeners(b.events.Save,{project:e.val(),replace:!0}):d.notifyListeners(b.events.CheckProjectExists,e.val())}),e.bind("keyup",function(a){var b=a.keyCode?a.keyCode:a.which;b==27&&d.cancel(),d.checkSaveable()}).bind("focus",function(a){e.val()==="Unsaved Project"&&e.val(""),d.notifyListeners(b.events.UpdateProjects),d.showButtons()}).bind("blur",function(){if(e.is(":visible")){var a=e.val();a===""&&d.reset()}}),this.checkSaveable()},m.prototype.reset=function(){this.saveIpt.val(this.loadedProject==null?"Unsaved Project":this.loadedProject),this.msg.empty().hide(),this.cancelBtn.hide().removeClass("overwite"),this.saveBtn.text("Save").removeClass("overwrite"),this.saveIpt.removeClass("overwrite").show(),this.checkSaveable()},m.prototype.showButtons=function(){this.buttons.slideDown(200)},m.prototype.stopPreview=function(){var b=this;setTimeout(function(){b.isPreview=!1},0),a.ui.getNavBar().setVisible(!0),this.sidePanel.setVisible(!0),this.topPanel.setVisible(!1)},m.prototype.updateExists=function(a,c){a?(this.msg.empty().html("Already exists.").show(),this.saveIpt.addClass("overwrite"),this.cancelBtn.show().addClass("overwrite"),this.saveBtn.text("Overwrite").addClass("overwrite")):(this.msg.hide(),this.notifyListeners(b.events.Save,{project:c,replace:!1}))},m.prototype.updateLoaded=function(a,b){b?(a===d&&(a="Restored Project"),this.loadedProject=a,this.reset(),this.saveIpt.show().effect("highlight",{color:"#3b5e77"})):(this.saveIpt.show(),this.msg.text("Server Down. Could not load.").show()),this.sidePanel.setVisible(!1),this.hideButtons()},m.prototype.updateNewProject=function(){this.loadedProject=null,this.reset(),this.sidePanel.setVisible(!1),this.hideButtons()},m.prototype.updateProjects=function(a){var b=this.sidePanel.prjListWidget,c=this;b.clear();if(a===null)this.msg.empty().text("Server Down").show(),this.saveIpt.hide();else for(var d=0,e=a.length;d<e;d++)b.add(a[d]);jQuery(document).bind("click.prj",function(a){var b=jQuery(a.target),d=b.parents(".prjSidePanel, #prjPane");d.size()==0&&b.attr("id")!=="prjPane"&&!c.isPreview&&c.cancel()})},m.prototype.updatePublished=function(a){var b=this.sidePanel.prjListWidget;b.update(a)},m.prototype.updateRemoved=function(a){this.loadedProject===a&&(this.loadedProject=null,this.reset())},m.prototype.updateSaved=function(a,b){b?a!==d&&(this.loadedProject=a,this.cancel(),this.saveIpt.effect("highlight",{color:"#3b5e77"})):this.msg.empty().text("Server Down. Could not save.").show()},m.prototype.updateServerRunning=function(a){a||this.msg.empty().text("Server Down.").show()};var n=function(){a.ToolController.call(this)},o=a.ToolController.prototype;n.prototype=new a.ToolController,n.prototype.constructor=n,n.prototype.bindEvents=function(){o.bindEvents.call(this);var c=this.model,d=this.view,e=d.sidePanel.prjListWidget,f=d.topPanel.previewWidget;d.addListener(b.events.CheckProjectExists,function(a){c.checkExisting(a)}),d.addListener(b.events.NewProject,function(){c.newProject()}),d.addListener(b.events.Publish,function(a){c.publish(a)}),d.addListener(b.events.Save,function(a){c.save(a.project,a.replace)}),d.addListener(b.events.StartPreview,function(){c.startPreview()}),d.addListener(b.events.UpdateProjects,function(){c.getProjects()}),e.addListener(b.events.Load,function(a){c.load(a)}),e.addListener(a.events.Remove,function(a){c.remove(a)}),f.addListener(b.events.StopPreview,function(){c.stopPreview(),d.stopPreview()}),c.addListener(b.events.Loaded,function(a){d.updateLoaded(a.project,a.succeeded)}),c.addListener(b.events.NewProject,function(){d.updateNewProject()}),c.addListener(b.events.ProjectExists,function(a){d.updateExists(a.exists,a.project)}),c.addListener(b.events.Projects,function(a){d.sidePanel.setVisible(!0),d.updateProjects(a)}),c.addListener(b.events.Published,function(a){d.updatePublished(a)}),c.addListener(a.events.Removing,function(a){d.updateRemoved(a),e.remove(a)}),c.addListener(b.events.Saved,function(a){d.updateSaved(a.project,a.saved),e.add({name:a.project,published:!1})}),c.addListener(b.events.ServerRunning,function(a){d.updateServerRunning(a)})},b.loadingDone=function(){c.dirty=!1,c.loading=!1}}(editor),function(a){"use strict";var b=a.plugins={};b.init=function(){var b=new a.ui.NavPane("Manage Plugins"),d=new a.ui.ToolBar,e=new c,h=new f,i=new g;i.setModel(e),i.setView(h),d.add(h),b.setToolBar(d),a.ui.addNavPane(b,"plgPane");var j=b.getUI();j.find("a").unbind("click"),j.find("h2").bind("click",function(a){b.setVisible(!b.isVisible()),jQuery(document).bind("click.plg",function(a){var c=jQuery(a.target),d=c.parents("#plgPane"),e=c.parents(".toolBtn").size()>0||c.hasClass("toolBtn"),f=c.parents("#navBar h2").size()>0;d.size()==0&&c.attr("id")!=="plgPane"&&!e&&!f&&(b.setVisible(!1),jQuery(document).unbind("click.plg"))})}),jQuery.get("js/editor/plugins/plugins.json","json").success(function(a,b,c){var d=a.plugins;d==null&&(d=JSON.parse(c.responseText).plugins);if(d!=null)for(var f=0,g=d.length;f<g;f++)e.loadPlugin(d[f])}).error(function(a,b,c){}),jQuery.get("/plugins").success(function(a,b,c){var d=a.plugins;for(var f=0,g=d.length;f<g;f++)e.addPlugin(d[f])}).error(function(a,b,c){})},b.events={Checked:"checked",PluginActive:"pluginActive",PluginAdded:"pluginAdded"};var c=function(){a.ToolModel.call(this,"pluginManager"),this.activePlugins=[],this.loadedPlugins=[],this.plugins=[],this.callbacks=[],this.scripts=new Hashtable,this.models=new Hashtable,this.views=new Hashtable,this.initComplete=!0,a.addListener(a.events.ScriptLoadStart,this),a.addListener(a.events.ScriptLoaded,this),a.addListener(a.events.ModelAdded,this),a.addListener(a.events.ViewAdded,this)};c.prototype=new a.ToolModel,c.prototype.constructor=c,c.prototype.loadingComplete=function(){var a=this.scripts.values(),b=!0;for(var c=0,d=a.length;c<d&&b;c++)b&=a[c];if(b){this.initComplete=!0;for(var c=0,d=this.callbacks.length;c<d;c++){var e=this.callbacks[c];e.callback.apply(this,e.params)}this.currentPlugin=null,this.callbacks=[]}},c.prototype.addPlugin=function(a){this.plugins.indexOf(a)===-1&&(this.plugins.push(a),this.notifyListeners(b.events.PluginAdded,a))},c.prototype.loadPlugin=function(c){var d=this;if(this.loadedPlugins.indexOf(c)===-1)a.tools[c]={},a.getScript("js/editor/plugins/"+c+"/"+c+".js"),this.callbacks.push({callback:function(c){d.currentPlugin=c,a.tools[c].init(),a.notifyListeners(a.events.PluginLoaded,c),d.activePlugins.push(c),d.loadedPlugins.push(c),d.plugins.indexOf(c)===-1&&(d.plugins.push(c),d.notifyListeners(a.events.PluginLoaded,c)),d.updatePluginList(),d.notifyListeners(b.events.PluginActive,{plugin:c,active:!0})},params:[c]});else if(this.activePlugins.indexOf(c)===-1){this.activePlugins.push(c);var e=this.views.get(c);for(var f=0,g=e.length;f<g;f++)e[f].setEnabled(!0);this.updatePluginList(),this.notifyListeners(b.events.PluginActive,{plugin:c,active:!0})}},c.prototype.notify=function(b,c){switch(b){case a.events.ScriptLoadStart:this.scripts.put(c,!1),this.initComplete=!1;break;case a.events.ScriptLoaded:this.scripts.put(c,!0),this.loadingComplete();break;case a.events.ModelAdded:if(this.currentPlugin!=null){var d=this.models.get(this.currentPlugin);d==null&&(d=[c.model]),this.models.put(this.currentPlugin,d)}break;case a.events.ViewAdded:if(this.currentPlugin!=null){var e=this.views.get(this.currentPlugin);e==null&&(e=[c.view]),this.views.put(this.currentPlugin,e)}}},c.prototype.removePlugin=function(a){this.activePlugins.splice(this.activePlugins.indexOf(a),1);var c=this.views.get(a);for(var d=0,e=c.length;d<e;d++)c[d].setEnabled(!1);this.notifyListeners(b.events.PluginActive,{plugin:a,active:!1}),this.updatePluginList()},c.prototype.updatePluginList=function(){if(this.initComplete){var a=this,b={plugins:a.activePlugins},c={plugins:JSON.stringify(b)};jQuery.post("/plugins",c,"json").success(function(a,b,c){}).error(function(a,b,c){})}};var d=function(){a.ui.ListItem.call(this)},e=a.ui.ListItem.prototype;d.prototype=new a.ui.ListItem,d.prototype.constructor=d,d.prototype.layout=function(){e.layout.call(this);var a=this;this.title=jQuery("<label></label>"),this.checkbox=jQuery('<input type="checkbox" />'),this.container.append(this.checkbox).append(this.title),this.checkbox.bind("change",function(){a.notifyListeners(b.events.Checked,{plugin:a.title.text(),checked:a.checkbox.prop("checked")})}),this.container.bind("click",function(b){var c=b.target.tagName==="INPUT",d=b.target.tagName==="LABEL";!c&&!d&&a.checkbox.click()})},d.prototype.setChecked=function(a){this.checkbox.prop("checked",a)},d.prototype.setText=function(a){var b="plg_li_"+a;this.title.text(a).attr("for",b),this.checkbox.attr("id",b)};var f=function(){a.ToolView.call(this,{id:"pluginManager",toolName:"Manage Plugins",toolTip:""}),this.listitems=new Hashtable};f.prototype=new a.ToolView,f.prototype.constructor=f,f.prototype.add=function(a){var c=new d,e=this;c.setText(a),c.addListener(b.events.Checked,function(a){e.notifyListeners(b.events.Checked,a)}),this.list.add(c),this.listitems.put(a,c)},f.prototype.layoutToolBarContainer=function(){var b=this.toolbarContainer=jQuery('<div id="'+this.id+'"> </div>');this.list=new a.ui.List,b.append(this.list.getUI())},f.prototype.setActive=function(a,b){this.listitems.get(a).setChecked(b)};var g=function(){a.ToolController.call(this)},h=a.ToolController.prototype;g.prototype=new a.ToolController,g.prototype.constructor=g,g.prototype.bindEvents=function(){h.bindEvents.call(this);var c=this.model,d=this.view;d.addListener(b.events.Checked,function(a){a.checked?c.loadPlugin(a.plugin):c.removePlugin(a.plugin)}),c.addListener(a.events.PluginLoaded,function(a){d.add(a)}),c.addListener(b.events.PluginActive,function(a){d.setActive(a.plugin,a.active)}),c.addListener(b.events.PluginAdded,function(a){d.add(a)})}}(editor)